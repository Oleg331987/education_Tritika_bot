import os
import sys
import logging
import asyncio
import signal
import time
import json
from datetime import datetime, timedelta
from typing import Optional, Dict, List, Set
import traceback
import aiohttp
from aiohttp import web
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –ò–º–ø–æ—Ä—Ç—ã aiogram
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command, CommandObject
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, FSInputFile, ReplyKeyboardMarkup, KeyboardButton
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.utils.keyboard import InlineKeyboardBuilder, ReplyKeyboardBuilder
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode, ContentType

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
bot_instance = None
dp_instance = None
shutdown_flag = False
restart_count = 0
max_restarts = 100
restart_delay = 10
PORT = int(os.environ.get("PORT", 8080))

# =========== –°–ò–°–¢–ï–ú–ê –î–û–°–¢–£–ü–ê –ò –ê–î–ú–ò–ù–ò–°–¢–†–ò–†–û–í–ê–ù–ò–Ø ===========
class AccessControl:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏"""
    
    def __init__(self):
        self.admins_file = "admins.json"
        self.paid_users_file = "paid_users.json"
        self.admins: Set[int] = set()
        self.paid_users: Set[int] = set()
        self.load_data()
        self.init_admins_from_env()
    
    def load_data(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–± –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞—Ö –∏ –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö"""
        try:
            if os.path.exists(self.admins_file):
                with open(self.admins_file, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    self.admins = set(data.get("admins", []))
                    logger.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.admins)} –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞")
            
            if os.path.exists(self.paid_users_file):
                with open(self.paid_users_file, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    self.paid_users = set(data.get("paid_users", []))
                    logger.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.paid_users)} –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞")
                    
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–∞: {e}")
            self.admins = set()
            self.paid_users = set()
    
    def init_admins_from_env(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        try:
            initial_admins = os.getenv('INITIAL_ADMINS', '')
            logger.info(f"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è INITIAL_ADMINS –∏–∑ .env: '{initial_admins}'")
            
            if initial_admins:
                admin_ids = []
                for admin_str in initial_admins.split(','):
                    admin_str = admin_str.strip()
                    if admin_str:
                        try:
                            admin_id = int(admin_str)
                            admin_ids.append(admin_id)
                        except ValueError:
                            logger.warning(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: {admin_str}")
                
                logger.info(f"–ù–∞–π–¥–µ–Ω—ã ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ .env: {admin_ids}")
                
                added_count = 0
                for admin_id in admin_ids:
                    if self.add_admin(admin_id):
                        added_count += 1
                        logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–∑ .env: {admin_id}")
                    else:
                        logger.info(f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {admin_id} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
                
                logger.info(f"–í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ .env: {added_count}")
            else:
                logger.warning("–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è INITIAL_ADMINS –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ .env —Ñ–∞–π–ª–µ")
                
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ .env: {e}")
    
    def save_admins(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"""
        try:
            with open(self.admins_file, 'w', encoding='utf-8') as f:
                json.dump({"admins": list(self.admins)}, f, ensure_ascii=False, indent=2)
            logger.info(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {len(self.admins)} –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ —Ñ–∞–π–ª")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {e}")
    
    def save_paid_users(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
        try:
            with open(self.paid_users_file, 'w', encoding='utf-8') as f:
                json.dump({"paid_users": list(self.paid_users)}, f, ensure_ascii=False, indent=2)
            logger.info(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {len(self.paid_users)} –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–∞–π–ª")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {e}")
    
    def is_admin(self, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"""
        result = user_id in self.admins
        logger.debug(f"–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è {user_id}: {result}")
        return result
    
    def is_paid_user(self, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø"""
        # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É
        result = user_id in self.paid_users or user_id in self.admins
        logger.debug(f"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è {user_id}: {result}")
        return result
    
    def add_admin(self, user_id: int) -> bool:
        """–î–æ–±–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        if user_id not in self.admins:
            self.admins.add(user_id)
            self.save_admins()
            return True
        return False
    
    def remove_admin(self, user_id: int) -> bool:
        """–£–¥–∞–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        if user_id in self.admins:
            self.admins.remove(user_id)
            self.save_admins()
            return True
        return False
    
    def add_paid_user(self, user_id: int) -> bool:
        """–î–æ–±–∞–≤–ª—è–µ—Ç –æ–ø–ª–∞—Ç–∏–≤—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if user_id not in self.paid_users:
            self.paid_users.add(user_id)
            self.save_paid_users()
            return True
        return False
    
    def remove_paid_user(self, user_id: int) -> bool:
        """–£–¥–∞–ª—è–µ—Ç –æ–ø–ª–∞—Ç–∏–≤—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if user_id in self.paid_users:
            self.paid_users.remove(user_id)
            self.save_paid_users()
            return True
        return False
    
    def get_all_admins(self) -> List[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"""
        return list(self.admins)
    
    def get_all_paid_users(self) -> List[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
        return list(self.paid_users)
    
    def get_user_info(self, user_id: int) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ"""
        return {
            "is_admin": self.is_admin(user_id),
            "is_paid": self.is_paid_user(user_id),
            "user_id": user_id
        }

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞
access_control = AccessControl()

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
USER_PROGRESS_FILE = "user_progress.json"

def load_user_progress():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞"""
    try:
        if os.path.exists(USER_PROGRESS_FILE):
            with open(USER_PROGRESS_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
                # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–ª—é—á–∏ –∏–∑ —Å—Ç—Ä–æ–∫ –≤ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
                return {int(k): v for k, v in data.items()}
        return {}
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {e}")
        return {}

def save_user_progress():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–∞–π–ª"""
    try:
        with open(USER_PROGRESS_FILE, 'w', encoding='utf-8') as f:
            json.dump(user_progress, f, ensure_ascii=False, indent=2)
        logger.info(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è {len(user_progress)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {e}")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
user_progress = load_user_progress()

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
async def auto_save_progress():
    """–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    while not shutdown_flag:
        await asyncio.sleep(300)  # 5 –º–∏–Ω—É—Ç
        try:
            save_user_progress()
            logger.info("–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: {e}")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è graceful shutdown
def signal_handler(sig, frame):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è graceful shutdown"""
    global shutdown_flag
    logger.info(f"–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª {sig}, –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è graceful shutdown...")
    shutdown_flag = True
    
    if bot_instance and dp_instance:
        asyncio.create_task(shutdown())
    else:
        sys.exit(0)

async def shutdown():
    """–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞"""
    logger.info("–ù–∞—á–∏–Ω–∞–µ–º graceful shutdown...")
    
    try:
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
        save_user_progress()
        logger.info("–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º")
        
        if dp_instance:
            await dp_instance.stop_polling()
            logger.info("Polling —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
        if bot_instance:
            await bot_instance.session.close()
            logger.info("–°–µ—Å—Å–∏—è –±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞")
            
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏: {e}")
    finally:
        logger.info("Shutdown –∑–∞–≤–µ—Ä—à–µ–Ω")
        sys.exit(0)

signal.signal(signal.SIGTERM, signal_handler)
signal.signal(signal.SIGINT, signal_handler)

BOT_TOKEN = os.getenv('BOT_TOKEN')
if not BOT_TOKEN:
    logger.error("BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env —Ñ–∞–π–ª–µ.")
    sys.exit(1)

bot = Bot(
    token=BOT_TOKEN,
    default=DefaultBotProperties(parse_mode=ParseMode.HTML)
)

storage = MemoryStorage()
dp = Dispatcher(storage=storage)

class UserState(StatesGroup):
    viewing_module = State()
    waiting_feedback = State()
    taking_test = State()
    test_question = State()
    admin_add_user = State()
    admin_remove_user = State()

AUDIO_CONFIG = {
    "base_path": "audio/",
    "default_format": ".mp3",
}

MODULES = [
    {
        "id": 1,
        "day": 1,
        "title": "–û—Å–Ω–æ–≤—ã –º–∏—Ä–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤",
        "emoji": "üìö",
        "content": """<b>üìö –î–µ–Ω—å 1 | –ú–æ–¥—É–ª—å 1: –û—Å–Ω–æ–≤—ã –º–∏—Ä–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤</b>

‚úÖ <b>–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–µ–Ω–¥–µ—Ä?</b>
–≠—Ç–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É —Ç–æ–≤–∞—Ä–æ–≤, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –∏–ª–∏ –æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–∫–∞–∑—á–∏–∫ –≤—ã–±–∏—Ä–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞—Ä–∞–Ω–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤.

–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, —ç—Ç–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞, –≥–¥–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–∞–Ω–∏–π (–ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤) –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —Å–≤–æ–∏ —É—Å–ª–æ–≤–∏—è (–≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —Ü–µ–Ω—É) –¥–ª—è –ø–æ–±–µ–¥—ã –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ, –∞ –∑–∞–∫–∞–∑—á–∏–∫ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º–æ–µ –≤—ã–≥–æ–¥–Ω–æ–µ –¥–ª—è —Å–µ–±—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.

‚úÖ <b>–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã:</b>
‚Ä¢ <b>–ó–∞–∫–∞–∑—á–∏–∫</b> ‚Äî –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ, –≥–æ—Å–∫–æ–º–ø–∞–Ω–∏—è, –±–∏–∑–Ω–µ—Å
‚Ä¢ <b>–ü–æ—Å—Ç–∞–≤—â–∏–∫</b> ‚Äî –∫–æ–º–ø–∞–Ω–∏—è (–í—ã)

‚úÖ <b>–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–∫–æ–Ω—ã:</b>
‚Ä¢ <b>44-–§–ó</b> ‚Äî –∂–µ—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≥–æ—Å–∑–∞–∫–∞–∑—á–∏–∫–æ–≤
‚Ä¢ <b>223-–§–ó</b> ‚Äî –≥–∏–±–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≥–æ—Å–∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–π
‚Ä¢ <b>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã</b> ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—è

üîó <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</b>
‚Ä¢ 44-–§–ó: https://www.consultant.ru/document/cons_doc_LAW_144624/
‚Ä¢ 223-–§–ó: https://www.consultant.ru/document/cons_doc_LAW_116964/
‚Ä¢ –ï–ò–°: https://zakupki.gov.ru

üìù <b>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</b>
–ù–∞–π–¥–∏—Ç–µ 2-3 —Ç–µ–Ω–¥–µ—Ä–∞ –≤ –≤–∞—à–µ–π —Å—Ñ–µ—Ä–µ: –æ–¥–∏–Ω –ø–æ 44-–§–ó, –æ–¥–∏–Ω –ø–æ 223-–§–ó –Ω–∞ —Å–∞–π—Ç–µ zakupki.gov.ru

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ó–∞–∫—É–ø–∫–∏¬ª
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞: 44-–§–ó, 223-–§–ó
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–π –≤–∞—Å –∑–∞–∫—É–ø–∫–∏
4. –ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–∏–º–µ–Ω–∏—Ç—å¬ª

<code>–ü—Ä–∏–º–µ—Ä –ø–æ–∏—Å–∫–∞: –ü–æ—Å—Ç–∞–≤–∫–∞ –æ—Ñ–∏—Å–Ω–æ–π –º–µ–±–µ–ª–∏</code>""",
        "task": "–ù–∞–π—Ç–∏ –∏ –∏–∑—É—á–∏—Ç—å 2 —Ç–µ–Ω–¥–µ—Ä–∞ –≤ –≤–∞—à–µ–π —Å—Ñ–µ—Ä–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "audio_file": "module1.mp3",
        "audio_duration": 120,
        "audio_title": "–û—Å–Ω–æ–≤—ã —Ç–µ–Ω–¥–µ—Ä–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã",
        "has_audio": True
    },
    {
        "id": 2,
        "day": 2,
        "title": "44-–§–ó",
        "emoji": "üèõÔ∏è",
        "content": """<b>üèõÔ∏è –î–µ–Ω—å 2 | –ú–æ–¥—É–ª—å 2: 44-–§–ó</b>

‚úÖ <b>–ö–ª—é—á–µ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–æ–∫:</b>

<b>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏:</b>
‚Ä¢ –ê—É–∫—Ü–∏–æ–Ω –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ (–ø–æ–±–µ–∂–¥–∞–µ—Ç —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π)
‚Ä¢ –ö–æ–Ω–∫—É—Ä—Å –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ (–ª—É—á—à–∏–µ —É—Å–ª–æ–≤–∏—è)
‚Ä¢ –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–æ–∫ (–±—ã—Å—Ç—Ä–æ, –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —Å—É–º–º)

<b>–ù–µ–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ:</b>
‚Ä¢ –ó–∞–∫—É–ø–∫–∞ —É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
‚Ä¢ –ú–∞–ª—ã–µ –∑–∞–∫—É–ø–∫–∏ –¥–æ 600 —Ç—ã—Å. —Ä—É–±.

‚úÖ <b>–≠—Ç–∞–ø—ã —É—á–∞—Å—Ç–∏—è:</b>
1. üìù –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å (–≠–ü)
2. üè¢ –ê–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ –≠–¢–ü
3. üîç –ü–æ–∏—Å–∫ –∑–∞–∫—É–ø–∫–∏
4. üìÑ –ò–∑—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
5. üí∞ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ (—Å–ø–µ—Ü—Å—á–µ—Ç –∏–ª–∏ –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è)
6. üì§ –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏
7. üéØ –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ
8. ü§ù –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
9. ‚úçÔ∏è –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
10. üìë –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
11. üìù –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–µ –∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

üìù <b>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</b>
–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –∞—É–∫—Ü–∏–æ–Ω –ø–æ 44-–§–ó –∏ –∏–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

1. –û—Ç–∫—Ä–æ–π—Ç–µ zakupki.gov.ru
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª ¬´–ó–∞–∫—É–ø–∫–∏¬ª
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä ¬´44-–§–ó¬ª
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–∫—É–ø–∫—É –Ω–∞ —Å—É–º–º—É –¥–æ 500 —Ç—ã—Å. —Ä—É–±.
5. –°–∫–∞—á–∞–π—Ç–µ –∏ –∏–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é""",
        "task": "–ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –æ–¥–Ω–æ–º—É –∞—É–∫—Ü–∏–æ–Ω—É –ø–æ 44-–§–ó",
        "audio_file": "module2.mp3",
        "audio_duration": 180,
        "audio_title": "–†–∞–±–æ—Ç–∞ —Å 44-–§–ó: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ",
        "has_audio": True
    },
    {
        "id": 3,
        "day": 3,
        "title": "223-–§–ó",
        "emoji": "üè¢",
        "content": """<b>üè¢ –î–µ–Ω—å 3 | –ú–æ–¥—É–ª—å 3: 223-–§–ó</b>

‚úÖ <b>–ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ:</b>
1. –£ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞ —Å–≤–æ—ë <b>–ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –∑–∞–∫—É–ø–∫–µ</b>
2. –†–µ–≥—É–ª–∏—Ä—É–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏ ‚Äî –∑–∞–∫–∞–∑—ã –≥–æ—Å–∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–π –∏ –∫—Ä—É–ø–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞

‚úÖ <b>–°–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–æ–∫:</b>
‚Ä¢ –õ—é–±—ã–µ (–∞—É–∫—Ü–∏–æ–Ω, –∑–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–æ–∫, –∫–æ–Ω–∫—É—Ä—Å, –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π)
‚Ä¢ –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∞–º –∑–∞–∫–∞–∑—á–∏–∫

‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</b>
1. üîç –ë–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤—É –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
2. üìä –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é
3. üíµ –¶–µ–Ω–∞ ‚Äî –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–µ—à–∞—é—â–∏–π —Ñ–∞–∫—Ç–æ—Ä
4. ü§ù –ë–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤

üîó <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</b>
‚Ä¢ –°—Ç–∞—Ç—å—è –æ 223-–§–ó: https://zakupki.kontur.ru/site/articles/22556-223fz2

üìù <b>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</b>
–ù–∞–π–¥–∏—Ç–µ –∑–∞–∫—É–ø–∫—É –ø–æ 223-–§–ó –æ—Ç –∫—Ä—É–ø–Ω–æ–π –≥–æ—Å–∫–æ–º–ø–∞–Ω–∏–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ zakupki.gov.ru
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ¬ª
3. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ü–æ–ª–æ–∂–µ–Ω–∏—è –æ –∑–∞–∫—É–ø–∫–µ 223-–§–ó¬ª
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–∫—É–ø–∫—É –æ—Ç –∫–æ–º–ø–∞–Ω–∏–π: –†–ñ–î, –†–æ—Å—Ç–µ–ª–µ–∫–æ–º, –ì–∞–∑–ø—Ä–æ–º
5. –ò–∑—É—á–∏—Ç–µ –ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –∑–∞–∫—É–ø–∫–µ""",
        "task": "–ù–∞–π—Ç–∏ –∏ –∏–∑—É—á–∏—Ç—å –ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –∑–∞–∫—É–ø–∫–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ 223-–§–ó",
        "audio_file": "module3.mp3",
        "audio_duration": 150,
        "audio_title": "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏ –ø–æ 223-–§–ó",
        "has_audio": True
    },
    {
        "id": 4,
        "day": 4,
        "title": "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã",
        "emoji": "üíº",
        "content": """<b>üíº –î–µ–Ω—å 4 | –ú–æ–¥—É–ª—å 4: –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã</b>

‚úÖ <b>–ö–ª—é—á–µ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–æ–∫:</b>

<b>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ:</b>
‚Ä¢ –ó–∞–ø—Ä–æ—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚Ä¢ –ê—É–∫—Ü–∏–æ–Ω—ã
‚Ä¢ –ö–æ–Ω–∫—É—Ä—Å—ã

<b>–ù–µ–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ:</b>
‚Ä¢ –ü—Ä—è–º—ã–µ –∑–∞–∫—É–ø–∫–∏ —É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏
‚Ä¢ –°—Ä–æ—á–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏

‚úÖ <b>–ì–¥–µ –∏—Å–∫–∞—Ç—å –∑–∞–∫—É–ø–∫–∏:</b>
1. üåê –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç–∞–ª—ã –∫–æ–º–ø–∞–Ω–∏–π (—Ä–∞–∑–¥–µ–ª—ã ¬´–ó–∞–∫—É–ø–∫–∏¬ª, ¬´–î–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤¬ª)
2. üè™ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏:
   ‚Ä¢ B2B-Center: https://www.b2b-center.ru
   ‚Ä¢ Bidzaar: https://bidzaar.com
   ‚Ä¢ Tender PRO: https://www.tender.pro
   ‚Ä¢ –°–±–µ—ÄB2B: https:/sberb2b.ru
3. ü§ù –ü—Ä—è–º—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å –æ—Ç–¥–µ–ª–æ–º –∑–∞–∫—É–ø–æ–∫

‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</b>
1. ‚≠ê –¶–µ–Ω–∏—Ç—Å—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
2. üí¨ –ë–æ–ª—å—à–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π
3. üìù –ú–µ–Ω—å—à–µ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–µ–π
4. ‚öñÔ∏è –ù–µ—Ç –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∑–∞–∫–ª—é—á–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º

üìù <b>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</b>
1. –°–æ—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–∑ 5-10 –∫–æ–º–ø–∞–Ω–∏–π –≤–∞—à–µ–π –æ—Ç—Ä–∞—Å–ª–∏
2. –ù–∞–π–¥–∏—Ç–µ –Ω–∞ –∏—Ö —Å–∞–π—Ç–∞—Ö —Ä–∞–∑–¥–µ–ª—ã –∑–∞–∫—É–ø–æ–∫
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ B2B-Center
4. –ù–∞–π–¥–∏—Ç–µ 3 –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –≤–∞—Å –∑–∞–∫—É–ø–∫–∏""",
        "task": "–°–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑—á–∏–∫–æ–≤ –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ B2B-Center",
        "audio_file": "module4.mp3",
        "audio_duration": 165,
        "audio_title": "–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞–º–∏",
        "has_audio": True
    },
    {
        "id": 5,
        "day": 5,
        "title": "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö",
        "emoji": "üè¶",
        "content": """<b>üè¶ –î–µ–Ω—å 5 | –ú–æ–¥—É–ª—å 5: –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö</b>

‚úÖ <b>–ß—Ç–æ —Ç–∞–∫–æ–µ –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è (–ë–ì)?</b>
–≠—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –±–∞–Ω–∫–∞ –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∑—è—Ç—ã—Ö –Ω–∞ —Å–µ–±—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –æ–¥–Ω–æ–π –∏–∑ —Å—Ç–æ—Ä–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞. –ì–∞—Ä–∞–Ω—Ç–∏—è –≤—ã–¥–∞—ë—Ç—Å—è –ø–æ –ø—Ä–æ—Å—å–±–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è. –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫ –Ω–∞—Ä—É—à–∞–µ—Ç —É—Å–ª–æ–≤–∏—è, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –ë–ì, –±–∞–Ω–∫ –≤—ã–ø–ª–∞—Ç–∏—Ç –∑–∞–∫–∞–∑—á–∏–∫—É –¥–æ–≥–æ–≤–æ—Ä–Ω—É—é —Å—É–º–º—É.

–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è: –ë–∞–Ω–∫ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤–∞—à–∏–º –ø–æ—Ä—É—á–∏—Ç–µ–ª–µ–º –ø–µ—Ä–µ–¥ –∑–∞–∫–∞–∑—á–∏–∫–æ–º.

‚úÖ <b>–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö?</b>

1. <b>–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏</b> ‚Äî —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Ç–µ–Ω–¥–µ—Ä–µ.

2. <b>–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</b> ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É.

3. <b>–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤</b> ‚Äî –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞, —Ä–∞–±–æ—Ç –∏–ª–∏ —É—Å–ª—É–≥ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –≤–µ—Å—å –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –ø–µ—Ä–∏–æ–¥.

–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ –∏ –æ–±—ã—á–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 0,5‚Äì5% –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–ù–ú–¶–ö). –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∂–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –≤ —Ç–µ–Ω–¥–µ—Ä–µ –∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 5‚Äì30% –æ—Ç —Ü–µ–Ω—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –ø–æ–ª–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

‚úÖ <b>–ö—Ç–æ –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏?</b>
–¢–æ–ª—å–∫–æ –±–∞–Ω–∫–∏, –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ –≤ –ü–µ—Ä–µ—á–µ–Ω—å –ú–∏–Ω—Ñ–∏–Ω–∞. –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç–µ –ú–∏–Ω—Ñ–∏–Ω–∞.

‚úÖ <b>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫—É—é –≥–∞—Ä–∞–Ω—Ç–∏—é?</b>

1. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –∫–æ–º–ø–∞–Ω–∏—é 
–û–û–û "–ë–ò–ó–ù–ï–°-–ü–û–î–î–ï–†–ñ–ö–ê":
—Å–∞–π—Ç - –±–∞–Ω–∫-–≥–∞—Ä–∞–Ω—Ç–∏—è.—Ä—Ñ
—Ç–µ–ª–µ—Ñ–æ–Ω: 8 800 600 04 60
e-mail: garant@bzgarant.com
   
–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É! –í—ã —Å –Ω–∞–º–∏ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç–µ –ë–ì –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –ø–æ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ. 
–ü–∏—à–∏—Ç–µ ¬´% –∑–∞ –ë–ì¬ª –≤ –¢–ì @malkovabzgarant –∏ –º—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º –∫–∞–∫.

2. –ü—Ä–∏—à–ª–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏

3. –ü–æ–ª—É—á–∏—Ç–µ –≥–∞—Ä–∞–Ω—Ç–∏—é –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –≤–∏–¥–µ.

‚úÖ <b>–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏:</b>

1. –ë–µ–∑–æ—Ç–∑—ã–≤–Ω–∞—è
2. –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (—Å—É–º–º–∞, —Å—Ä–æ–∫, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã —Å—Ç–æ—Ä–æ–Ω)
3. –í–Ω–µ—Å–µ–Ω–∞ –≤ —Ä–µ–µ—Å—Ç—Ä –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π
4. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ.

üîó <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</b>
‚Ä¢ –ü–µ—Ä–µ—á–µ–Ω—å –±–∞–Ω–∫–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ –ú–∏–Ω—Ñ–∏–Ω–∞: https://minfin.gov.ru/ru/perfomance/tender/banks/
‚Ä¢ –ï–ò–°: https://zakupki.gov.ru""",
        "task": "–ù–∞–π–¥–∏—Ç–µ –≤ –ï–ò–° (zakupki.gov.ru) 2-3 —Ç–µ–Ω–¥–µ—Ä–∞, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –∏–ª–∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ò–∑—É—á–∏—Ç–µ, –≤ –∫–∞–∫–æ–π —Ñ–æ—Ä–º–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (–¥–µ–Ω—å–≥–∏ –∏–ª–∏ –ë–ì). –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –ø—Ä–∏–º–µ—Ä–æ–º –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ –ú–∏–Ω—Ñ–∏–Ω–∞ –∏–ª–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –±–∞–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –°–±–µ—Ä, –í–¢–ë, –¢–∏–Ω—å–∫–æ—Ñ—Ñ).",
        "audio_file": "module5.mp3",
        "audio_duration": 180,
        "audio_title": "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö: –∫–∞–∫ —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫–∏",
        "has_audio": True
    },
    {
        "id": 6,
        "day": 6,
        "title": "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç",
        "emoji": "üöÄ",
        "content": """<b>üöÄ –î–µ–Ω—å 6 | –ú–æ–¥—É–ª—å 6: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç</b>

‚úÖ <b>–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:</b>

1. <b>–ü–æ–ª—É—á–∏—Ç–µ –≠–¶–ü:</b>
   ‚Ä¢ –î–ª—è –û–û–û/–ò–ü ‚Äî –≤ –ù–∞–ª–æ–≥–æ–≤–æ–º –æ—Ä–≥–∞–Ω–µ
   ‚Ä¢ –î–ª—è –§–õ - –≤ –∞–∫–∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–Ω–æ–º –£–¶ (https://uc-itcom.ru)
   ‚Ä¢ –æ—Ñ–æ—Ä–º–∏—Ç—å –£–ö–≠–ü —Ñ–∏–∑–ª–∏—Ü–∞ –∏ –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—É—é –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–ú–ß–î) –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏

2. <b>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ:</b>
   ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ö—Ä–∏–ø—Ç–æ–ü–†–û CSP
   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä Chromium-Gost
   ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –†—É—Ç–æ–∫–µ–Ω –î—Ä–∞–π–≤–µ—Ä
   ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ –≠–¶–ü Browser plug-in, –ø–ª–∞–≥–∏–Ω –ì–ò–° –ù–†, –ø–ª–∞–≥–∏–Ω –ì–æ—Å–£—Å–ª—É–≥

3. <b>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º–∞—Ö:</b>
   ‚Ä¢ –ì–æ—Å—É—Å–ª—É–≥–∏ (–ï–ò–ê): https://www.gosuslugi.ru - –¥–æ–±–∞–≤—å—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
   ‚Ä¢ –ï–ò–°: https://zakupki.gov.ru - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
   
4. <b>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–ø–µ—Ü—Å—á–µ—Ç</b> –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞—è–≤–æ–∫

5. <b>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–∏—Å–∫</b> –ø–æ –≤–∞—à–∏–º —Ç–æ–≤–∞—Ä–∞–º/—É—Å–ª—É–≥–∞–º

‚úÖ <b>–ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ:</b>
1. –í—ã–±–µ—Ä–∏—Ç–µ 1-2 –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ–Ω–¥–µ—Ä–∞
2. –ò–∑—É—á–∏—Ç–µ –í–°–Æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∑–∞—è–≤–∫—É —Å—Ç—Ä–æ–≥–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
4. –ù–µ –±–æ–π—Ç–µ—Å—å –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Ä–∞–∑—ä—è—Å–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫—É

‚ùå <b>–ö–ª—é—á–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –Ω–æ–≤–∏—á–∫–æ–≤:</b>
1. –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
3. –û–ø–æ–∑–¥–∞—Ç—å —Å –ø–æ–¥–∞—á–µ–π
4. –ù–µ –≤–Ω–µ—Å—Ç–∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç–∏–µ
5. –ë–æ—è—Ç—å—Å—è –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∑–∞–∫–∞–∑—á–∏–∫—É

üéØ <b>–í–∞—à –ø–µ—Ä–≤—ã–π —Ç–µ–Ω–¥–µ—Ä ‚Äî —ç—Ç–æ —Ü–µ–Ω–Ω—ã–π –æ–ø—ã—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –ø–æ–±–µ–¥–∏—Ç–µ!</b>""",
        "task": "–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π",
        "audio_file": "module6.mp3",
        "audio_duration": 210,
        "audio_title": "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω: –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö",
        "has_audio": True
    },
    {
        "id": 7,
        "day": 7,
        "title": "–ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞",
        "emoji": "üèÜ",
        "content": """<b>üèÜ –î–µ–Ω—å 7 | –ú–æ–¥—É–ª—å 7: –ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞</b>

‚úÖ <b>–ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞:</b>

–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã –∑–Ω–∞–µ—Ç–µ:
1. –†–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É 44-–§–ó, 223-–§–ó –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ –∑–∞–∫—É–ø–∫–∞–º–∏
2. –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è —É—á–∞—Å—Ç–∏—è
3. –ì–¥–µ –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Ç–µ–Ω–¥–µ—Ä—ã
4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

üéØ <b>–í–∞—à —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –î–ï–ô–°–¢–í–ò–ï!</b>

‚úÖ <b>–ß–µ–∫-–ª–∏—Å—Ç "–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö"</b>

–í–∞—à –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏:

<b>‚úÖ –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</b>
1. –û–ø—Ä–µ–¥–µ–ª–∏–ª–∏, –∫–∞–∫–∏–µ —Å–≤–æ–∏ —Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —á–µ—Ä–µ–∑ —Ç–µ–Ω–¥–µ—Ä—ã.
2. –í—ã—è—Å–Ω–∏–ª–∏ –∫–æ–¥—ã –û–ö–ü–î2/–û–ö–í–≠–î2 –¥–ª—è —Å–≤–æ–µ–≥–æ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

<b>‚úÖ –®–∞–≥ 2: –ò–∑—É—á–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞</b>
1. –ü—Ä–æ–≤–µ–ª–∏ —Ä–∞–∑–≤–µ–¥–∫—É –Ω–∞ zakupki.gov.ru: –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏, –∫–∞–∫–∏–µ –∑–∞–∫—É–ø–∫–∏ –µ—Å—Ç—å –ø–æ –≤–∞—à–∏–º —Ç–æ–≤–∞—Ä–∞–º/—Ä–∞–±–æ—Ç–∞–º/—É—Å–ª—É–≥–∞–º, –∫—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–∫–∞–∑—á–∏–∫–∏ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã.
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –∏—Ç–æ–≥–æ–≤—ã–µ —Ü–µ–Ω—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç —Å–Ω–∏–∂–µ–Ω–∏—è.

<b>‚úÖ –®–∞–≥ 3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏, –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–ø–µ—Ü—Å—á–µ—Ç–∞</b>
1. –ü—Ä–æ–≤–µ—Ä–∏–ª–∏, —á—Ç–æ –≤—Å–µ —É—á—Ä–µ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–£—Å—Ç–∞–≤, –≤—ã–ø–∏—Å–∫–∞ –∏–∑ –ï–ì–†–Æ–õ/–ï–ì–†–ò–ü –∏ –¥—Ä.) –∞–∫—Ç—É–∞–ª—å–Ω—ã.
2. –û—Ç–∫—Ä—ã–ª–∏ —Å–ø–µ—Ü—Å—á–µ—Ç –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞—è–≤–∫–∏.
3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.

<b>‚úÖ –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏ (–≠–¶–ü), —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ï–°–ò–ê</b>
1. –ü–æ–ª—É—á–∏–ª–∏ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å (–ö–≠–ü).
2. –ï—Å–ª–∏ –Ω–∞ –ø–æ—Ä—Ç–∞–ª–∞—Ö –¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏, –æ—Ñ–æ—Ä–º–∏–ª–∏ –Ω–∞ –Ω–µ–≥–æ –ö–≠–ü —Ñ–∏–∑–ª–∏—Ü–∞ –∏ –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—É—é –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–ú–ß–î).
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –Ω–∞ —Å–∞–π—Ç–µ –≥–æ—Å—É—Å–ª—É–≥ (–≤ –ï–°–ò–ê).
4. –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –ü–û (–ö—Ä–∏–ø—Ç–æ–ü–†–û CSP, –ø–ª–∞–≥–∏–Ω –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ, –ø–ª–∞–≥–∏–Ω –ì–ò–° –ù–†, —Ä—É—Ç–æ–∫–µ–Ω –¥—Ä–∞–π–≤–µ—Ä, –±—Ä–∞—É–∑–µ—Ä Chromium-Gost).

<b>‚úÖ –®–∞–≥ 5: –ê–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö (–≠–¢–ü)</b>
1. –ü–æ–¥–∞–ª–∏ –∑–∞—è–≤–∫—É –Ω–∞ –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—é –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ï–ò–°.
2. –î–æ–∂–¥–∞–ª–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ –¥–æ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π).

<b>‚úÖ –®–∞–≥ 6: –í—ã–±–æ—Ä –ø–µ—Ä–≤–æ–π –∑–∞–∫—É–ø–∫–∏</b>
1. –ù–∞—à–ª–∏ –Ω–∞ zakupki.gov.ru –ø–æ–¥—Ö–æ–¥—è—â—É—é –∑–∞–∫—É–ø–∫—É –ø–æ 44-–§–ó (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ó–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–æ–∫"), 223-–§–ó —Å –Ω–µ–±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∏–ª–∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π —Ç–µ–Ω–¥–µ—Ä.
2. –í–Ω–µ—Å–ª–∏ –µ–µ –≤ —Å–≤–æ–π –ø–ª–∞–Ω-–∫–∞–ª–µ–Ω–¥–∞—Ä—å, –æ—Ç–º–µ—Ç–∏–≤ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–æ–∫.

<b>‚úÖ –®–∞–≥ 7: –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏</b>
1. –°–∫–∞—á–∞–ª–∏ –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –≤—Å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–∫—É–ø–∫–µ.
2. –í—ã–¥–µ–ª–∏–ª–∏ —Ü–≤–µ—Ç–æ–º –∫–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞.

<b>‚úÖ –®–∞–≥ 8: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏</b>
1. –°–æ–±—Ä–∞–ª–∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ç—Ä–µ–±—É–µ–º—ã–µ –≤ –∑–∞—è–≤–∫–µ (–ø–æ –ø–µ—Ä–µ—á–Ω—é –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏).
2. –ó–∞–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ —Ñ–æ—Ä–º—ã –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ.
3. –í–Ω–µ—Å–ª–∏ –¥–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ —Å–ø–µ—Ü—Å—á–µ—Ç –∏–ª–∏ –ø–æ–¥–∞–ª–∏ –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏ (–ë–ì) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞—è–≤–∫–∏.
4. –û—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞—è–≤–∫–∏ –ó–ê–†–ê–ù–ï–ï, –º–∏–Ω–∏–º—É–º –∑–∞ 1 –¥–µ–Ω—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ä–æ–∫–∞.

<b>‚úÖ –®–∞–≥ 9: –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ</b>
1. –ï—Å–ª–∏ —ç—Ç–æ –∞—É–∫—Ü–∏–æ–Ω, –∏–∑—É—á–∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–ª–æ—â–∞–¥–∫–∏ –∏ –ø—Ä–∏–Ω—è–ª–∏ –≤ –Ω–µ–º —É—á–∞—Å—Ç–∏–µ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
2. –°–ª–µ–¥–∏–ª–∏ –∑–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ –Ω–∞ –≠–¢–ü –∏ –Ω–∞ zakupki.gov.ru.

<b>‚úÖ –®–∞–≥ 10: –†–∞–±–æ—Ç–∞ —Å –∏—Ç–æ–≥–∞–º–∏</b>
1. –í —Å–ª—É—á–∞–µ –ø–æ–±–µ–¥—ã: –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞, –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ –µ–≥–æ, –≤–Ω–µ—Å–ª–∏ –¥–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏–ª–∏ –æ—Ñ–æ—Ä–º–∏–ª–∏ –±–∞–Ω–∫–æ–≤—Å–∫—É—é –≥–∞—Ä–∞–Ω—Ç–∏—é (–ë–ì) –Ω–∞ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ü—Ä–∏–ª–æ–∂–∏–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–¥–ø–∏—Å–∞–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –ø—Ä–∏—Å—Ç—É–ø–∏–ª–∏ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é.
2. –í —Å–ª—É—á–∞–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞: –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫—Ç–æ –ø–æ–±–µ–¥–∏–ª, –ø–æ –∫–∞–∫–æ–π —Ü–µ–Ω–µ –∏ –ø–æ—á–µ–º—É. –°–¥–µ–ª–∞–ª–∏ –≤—ã–≤–æ–¥—ã –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞—è–≤–∫–∏.

<b>–í–∞–∂–Ω–æ:</b> –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ —à–∞–≥–∏ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å! –†–∞–∑–±–µ–π—Ç–µ –ø–ª–∞–Ω –Ω–∞ 5-7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–∞—á–∞—Ç—å –∏ –ø—Ä–æ–π—Ç–∏ –≤–µ—Å—å –ø—É—Ç—å –æ—Ç –≤—ã–±–æ—Ä–∞ –∑–∞–∫—É–ø–∫–∏ –¥–æ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏.

üì• <b>–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô –ú–ê–¢–ï–†–ò–ê–õ:</b>

–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–ª—è –≤–∞—Å <b>–≥–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Word</b>, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –º–æ–∂–µ—Ç–µ:
‚Ä¢ üìÅ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä
‚Ä¢ üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∏ –æ—Ç–º–µ—á–∞—Ç—å —à–∞–≥–∏
‚Ä¢ üì± –î–µ—Ä–∂–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–º –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏–ª–∏ –ø–ª–∞–Ω—à–µ—Ç–µ
‚Ä¢ üìé –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –ø–∞–º—è—Ç–∫—É –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ

<b>–ß—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!</b>

–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ –∂–µ 10 —à–∞–≥–æ–≤, –Ω–æ –≤ —É–¥–æ–±–Ω–æ–º –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ñ–æ—Ä–º–∞—Ç–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–µ–ª–∞—Ç—å –ø–æ–º–µ—Ç–∫–∏.

üéÅ <b>–ê –≤ —Å–ª–µ–¥—É—é—â–µ–º, 8-–º –º–æ–¥—É–ª–µ, –≤–∞—Å –∂–¥—É—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –∏ –±–æ–Ω—É—Å—ã –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤ –∫—É—Ä—Å–∞!</b>""",
        "task": "–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É",
        "audio_file": "module7.mp3",
        "audio_duration": 180,
        "audio_title": "–ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞: —á–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤ –∏ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π",
        "has_audio": True
    },
    {
        "id": 8,
        "day": 8,
        "title": "–ü–æ–¥–∞—Ä–∫–∏",
        "emoji": "üéÅ",
        "content": """<b>üéÅ –î–µ–Ω—å 8 | –ú–æ–¥—É–ª—å 8: –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –Ω–∞—à–∏—Ö –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤</b>

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –∫—É—Ä—Å–∞ ¬´–¢–µ–Ω–¥–µ—Ä—ã —Å –Ω—É–ª—è¬ª! –í—ã —Å–¥–µ–ª–∞–ª–∏ –≤–∞–∂–Ω—ã–π —à–∞–≥ –∫ –Ω–æ–≤—ã–º –ø–æ–±–µ–¥–∞–º. –ú—ã –≤ ¬´–¢—Ä–∏—Ç–∏–∫–µ¬ª —Ü–µ–Ω–∏–º –Ω–∞—à–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–ª—è –≤–∞—Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –∏ –≤—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é.

–ß—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤–∞—Å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ, –º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—É—é <b>—Å–∫–∏–¥–∫—É 10% –Ω–∞ –ø–µ—Ä–≤—É—é —É—Å–ª—É–≥—É –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞</b>:

<b>üéØ –£—Å–ª—É–≥–∞: –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–Ω–¥–µ—Ä–∞</b>
<b>‚úÖ –í–∞—à–∞ –≤—ã–≥–æ–¥–∞:</b> –°–∫–∏–¥–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ
<b>üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</b> –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞. –í—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Ç–µ–Ω–¥–µ—Ä, –∞ –Ω–∞—à–∏ —ç–∫—Å–ø–µ—Ä—Ç—ã –ø–æ–º–æ–≥—É—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É ¬´–ø–æ–¥ –∫–ª—é—á¬ª, –∏–∑–±–µ–≥–∞—è –æ—à–∏–±–æ–∫.

<b>üéØ –£—Å–ª—É–≥–∞: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É—á–∞—Å—Ç–∏—è</b>
<b>‚úÖ –í–∞—à–∞ –≤—ã–≥–æ–¥–∞:</b> –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—É—Ä—Å–∞
<b>üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</b> –û–±—Å—É–¥–∏—Ç–µ —Å –Ω–∞—à–∏–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏, –≤—ã–±–æ—Ä —Ç–µ–Ω–¥–µ—Ä–æ–≤ –∏ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏.

<b>üìû –ö–∞–∫ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</b>
–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É <b>+7 (4922) 223-222</b> –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ <b>info@tritika.ru</b>, —É–∫–∞–∑–∞–≤ –≤ —Ç–µ–º–µ –ø–∏—Å—å–º–∞ <b>¬´–í—ã–ø—É—Å–∫–Ω–∏–∫ —ç–∫—Å–ø—Ä–µ—Å—Å-–∫—É—Ä—Å–∞, –§–ò–û¬ª</b>.

<b>üí° –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –∑–Ω–∞–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –≤—ã–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø–µ—Ä–≤—ã—Ö –ø–æ–±–µ–¥. –ú—ã –±—É–¥–µ–º —Ä–∞–¥—ã –ø–æ–º–æ—á—å –≤–∞–º –≤ —ç—Ç–æ–º!</b>

<b>üèÜ –ö–æ–º–∞–Ω–¥–∞ ¬´–¢—Ä–∏—Ç–∏–∫–∏¬ª –∂–µ–ª–∞–µ—Ç –≤–∞–º —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–æ–≤ –∏ –≤—ã–≥–æ–¥–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤!</b>

<b>üìå –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏:</b>
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +7 (4922) 223-222
‚Ä¢ –ú–æ–±–∏–ª—å–Ω—ã–π: +7-904-653-69-87
‚Ä¢ Email: info@tritika.ru
‚Ä¢ –°–∞–π—Ç: https://tritika.ru
‚Ä¢ –¢–µ–ª–µ–≥—Ä–∞–º: @tritikaru

<b>üéØ –ù–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ —Ç–æ, —á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è! –í–∞—à –ø–µ—Ä–≤—ã–π —Ç–µ–Ω–¥–µ—Ä –∂–¥–µ—Ç –≤–∞—Å!</b>""",
        "task": "–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–æ–≤ –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º –≤—ã—à–µ",
        "audio_file": "module8.mp3",
        "audio_duration": 150,
        "audio_title": "–ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤ –∫—É—Ä—Å–∞",
        "has_audio": True
    }
]

TEST_QUESTIONS = [
    {
        "id": 1,
        "question": "–ö–∞–∫–æ–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –∑–∞–∫—É–ø–∫–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±—é–¥–∂–µ—Ç–Ω—ã—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–∞, –±–æ–ª—å–Ω–∏—Ü—ã, —à–∫–æ–ª—ã) –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏?",
        "options": {
            "–∞": "223-–§–ó",
            "–±": "–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –∫–æ–¥–µ–∫—Å –†–§",
            "–≤": "44-–§–ó",
            "–≥": "94-–§–ó"
        },
        "correct": "–≤",
        "correct_text": "–≤) 44-–§–ó"
    },
    {
        "id": 2,
        "question": "–û—Å–Ω–æ–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –∑–∞–∫—É–ø–æ–∫ –ø–æ 223-–§–ó –æ—Ç –∑–∞–∫—É–ø–æ–∫ –ø–æ 44-–§–ó –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ:",
        "options": {
            "–∞": "–£ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞ –ø–æ 223-–§–ó –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –∑–∞–∫—É–ø–∫–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∏–∑—É—á–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.",
            "–±": "–ó–∞–∫—É–ø–∫–∏ –ø–æ 223-–§–ó –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –≤ –≤–∏–¥–µ –∞—É–∫—Ü–∏–æ–Ω–∞.",
            "–≤": "–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∑–∞–∫—É–ø–∫–∞—Ö –ø–æ 223-–§–ó –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å.",
            "–≥": "–ó–∞–∫—É–ø–∫–∏ –ø–æ 223-–§–ó –Ω–µ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö."
        },
        "correct": "–∞",
        "correct_text": "–∞) –£ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞ –ø–æ 223-–§–ó –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –∑–∞–∫—É–ø–∫–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∏–∑—É—á–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å."
    },
    {
        "id": 3,
        "question": "–ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –∑–∞–∫—É–ø–∫–∏ –ø–æ 44-–§–ó —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–º, –≥–¥–µ –ø–æ–±–µ–∂–¥–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫, –ø—Ä–µ–¥–ª–æ–∂–∏–≤—à–∏–π —Å–∞–º—É—é –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É?",
        "options": {
            "–∞": "–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–Ω–∫—É—Ä—Å",
            "–±": "–ó–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–æ–∫",
            "–≤": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω",
            "–≥": "–ó–∞–∫—Ä—ã—Ç—ã–π –∫–æ–Ω–∫—É—Ä—Å"
        },
        "correct": "–≤",
        "correct_text": "–≤) –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω"
    },
    {
        "id": 4,
        "question": "–ö–∞–∫–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ —É—á–∞—Å—Ç–∏—è –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–∞—Ö –ø–æ 44-–§–ó –∏ 223-–§–ó?",
        "options": {
            "–∞": "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ç–µ–Ω–¥–µ—Ä ‚Üí –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é ‚Üí –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å",
            "–±": "–ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å ‚Üí –ü—Ä–æ–π—Ç–∏ –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—é –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö (–≠–¢–ü) ‚Üí –ù–∞–π—Ç–∏ –∑–∞–∫—É–ø–∫—É",
            "–≤": "–ù–∞–π—Ç–∏ –∑–∞–∫—É–ø–∫—É ‚Üí –ó–∞–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Üí –í–Ω–µ—Å—Ç–∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏",
            "–≥": "–ê–∫–∫—Ä–µ–¥–∏—Ç–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≠–¢–ü ‚Üí –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∞—É–∫—Ü–∏–æ–Ω–µ ‚Üí –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å"
        },
        "correct": "–±",
        "correct_text": "–±) –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å ‚Üí –ü—Ä–æ–π—Ç–∏ –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—é –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö (–≠–¢–ü) ‚Üí –ù–∞–π—Ç–∏ –∑–∞–∫—É–ø–∫—É"
    },
    {
        "id": 5,
        "question": "–ö–∞–∫–∞—è –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ–π —Ç–∏–ø–∏—á–Ω–æ–π –¥–ª—è –Ω–æ–≤–∏—á–∫–∞ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö?",
        "options": {
            "–∞": "–°–ª–∏—à–∫–æ–º –¥–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è.",
            "–±": "–ó–∞–¥–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –∑–∞–∫–∞–∑—á–∏–∫—É.",
            "–≤": "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –º–µ–ª–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ –≤–æ–≤—Ä–µ–º—è –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É.",
            "–≥": "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ—à–ª—ã—Ö –∑–∞–∫—É–ø–æ–∫."
        },
        "correct": "–≤",
        "correct_text": "–≤) –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –º–µ–ª–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ –≤–æ–≤—Ä–µ–º—è –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É."
    },
    {
        "id": 6,
        "question": "–î–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫—É–ø–∫–∏ –∫—Ä—É–ø–Ω–æ–π —á–∞—Å—Ç–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏) —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ:",
        "options": {
            "–∞": "–°—Ç—Ä–æ–≥–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ 44-–§–ó.",
            "–±": "–ì–ª–∞–≤–Ω—ã–π –∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫—Ä–∏—Ç–µ—Ä–∏–π –ø–æ–±–µ–¥—ã ‚Äî —Å–∞–º–∞—è –Ω–∏–∑–∫–∞—è —Ü–µ–Ω–∞.",
            "–≤": "–ü—Ä–∞–≤–∏–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∞–º–∞ –∫–æ–º–ø–∞–Ω–∏—è-–∑–∞–∫–∞–∑—á–∏–∫, —Å–∏–ª—å–Ω–æ —Ü–µ–Ω–∏—Ç—Å—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è.",
            "–≥": "–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—Å–µ–≥–¥–∞ –ø—É–±–ª–∏—á–Ω—ã –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Å–ø–æ—Ä–µ–Ω—ã."
        },
        "correct": "–≤",
        "correct_text": "–≤) –ü—Ä–∞–≤–∏–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∞–º–∞ –∫–æ–º–ø–∞–Ω–∏—è-–∑–∞–∫–∞–∑—á–∏–∫, —Å–∏–ª—å–Ω–æ —Ü–µ–Ω–∏—Ç—Å—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è."
    },
    {
        "id": 7,
        "question": "–ö–∞–∫–æ–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–æ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫—É–ø–∫–∏ –ø–æ 44-–§–ó –∏ 223-–§–ó?",
        "options": {
            "–∞": "b2b-center.ru",
            "–±": "sberbank-ast.ru",
            "–≤": "zakupki.gov.ru",
            "–≥": "roseltorg.ru"
        },
        "correct": "–≤",
        "correct_text": "–≤) zakupki.gov.ru"
    },
    {
        "id": 8,
        "question": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö ‚Äî —ç—Ç–æ:",
        "options": {
            "–∞": "–°—Ä–∞–∑—É —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ 10 –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–∞—Ö.",
            "–±": "–í—ã–±—Ä–∞—Ç—å 1-2 –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ–Ω–¥–µ—Ä–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—ã—Ç–∞.",
            "–≤": "–ñ–¥–∞—Ç—å, –ø–æ–∫–∞ –∑–∞–∫–∞–∑—á–∏–∫ —Å–∞–º –Ω–∞–π–¥–µ—Ç –≤–∞—Å –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç.",
            "–≥": "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ç–µ–Ω–¥–µ—Ä–∞—Ö, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ."
        },
        "correct": "–±",
        "correct_text": "–±) –í—ã–±—Ä–∞—Ç—å 1-2 –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ–Ω–¥–µ—Ä–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—ã—Ç–∞."
    }
]

ADDITIONAL_MATERIALS = {
    "links": {
        "–ï–ò–°": "https://zakupki.gov.ru",
        "–ì–æ—Å—É—Å–ª—É–≥–∏": "https://www.gosuslugi.ru",
        "B2B-Center": "https://www.b2b-center.ru",
        "–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–ü–ª—é—Å 44-–§–ó": "https://www.consultant.ru/document/cons_doc_LAW_144624/",
        "–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä": "https://uc-itcom.ru",
        "–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—É—Ä—Å–∞": "https://tritika.ru",
        "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏": "https://tritika.ru/privacy"
    },
    "contacts": {
        "email": "info@tritika.ru",
        "phone": "+7(4922)223-222",
        "mobile": "+7-904-653-69-87",
        "website": "https://tritika.ru",
        "telegram": "@tritikaru"
    }
}

# =========== –ö–õ–ê–í–ò–ê–¢–£–†–´ ===========
def get_main_keyboard(user_id: int) -> ReplyKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    is_paid = access_control.is_paid_user(user_id)
    
    if is_paid:
        keyboard = ReplyKeyboardMarkup(
            keyboard=[
                [
                    KeyboardButton(text="üìö –ú–µ–Ω—é –∫—É—Ä—Å–∞"),
                    KeyboardButton(text="üéß –ê—É–¥–∏–æ —É—Ä–æ–∫–∏"),
                ],
                [
                    KeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å"),
                    KeyboardButton(text="üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã"),
                ],
                [
                    KeyboardButton(text="üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏"),
                    KeyboardButton(text="üÜò –ü–æ–º–æ—â—å"),
                ],
                [
                    KeyboardButton(text="üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç"),
                    KeyboardButton(text="üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞")
                ],
                [
                    KeyboardButton(text="‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏"),
                    KeyboardButton(text="üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç")
                ]
            ],
            resize_keyboard=True,
            one_time_keyboard=False,
            input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ..."
        )
        
        if access_control.is_admin(user_id):
            keyboard.keyboard.append([KeyboardButton(text="üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º")])
    else:
        keyboard = ReplyKeyboardMarkup(
            keyboard=[
                [
                    KeyboardButton(text="üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø"),
                    KeyboardButton(text="üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã"),
                ],
                [
                    KeyboardButton(text="üÜò –ü–æ–º–æ—â—å"),
                    KeyboardButton(text="‚ÑπÔ∏è –û –∫—É—Ä—Å–µ"),
                ]
            ],
            resize_keyboard=True,
            one_time_keyboard=False,
            input_field_placeholder="–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É..."
        )
    
    return keyboard

def get_admin_keyboard() -> ReplyKeyboardMarkup:
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º"),
                KeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
            ],
            [
                KeyboardButton(text="üì¢ –†–∞—Å—Å—ã–ª–∫–∞"),
                KeyboardButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"),
            ],
            [
                KeyboardButton(text="üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"),
            ]
        ],
        resize_keyboard=True,
        one_time_keyboard=False
    )
    return keyboard

def get_access_management_keyboard() -> ReplyKeyboardMarkup:
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"),
                KeyboardButton(text="‚ûñ –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"),
            ],
            [
                KeyboardButton(text="üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),
                KeyboardButton(text="üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏"),
            ],
            [
                KeyboardButton(text="üîô –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É"),
            ]
        ],
        resize_keyboard=True,
        one_time_keyboard=False
    )
    return keyboard

def get_admin_management_keyboard() -> ReplyKeyboardMarkup:
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="üëë –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"),
                KeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"),
            ],
            [
                KeyboardButton(text="üìã –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"),
                KeyboardButton(text="üîô –ù–∞–∑–∞–¥"),
            ]
        ],
        resize_keyboard=True,
        one_time_keyboard=False
    )
    return keyboard

def get_lesson_navigation_keyboard(current_index: int, total_modules: int) -> ReplyKeyboardMarkup:
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫"),
                KeyboardButton(text=f"üìñ {current_index+1}/{total_modules}"),
                KeyboardButton(text="–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ ‚û°Ô∏è"),
            ],
            [
                KeyboardButton(text="üéß –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ"),
                KeyboardButton(text="‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º"),
            ],
            [
                KeyboardButton(text="üìö –ú–µ–Ω—é –∫—É—Ä—Å–∞"),
                KeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å"),
                KeyboardButton(text="üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
            ]
        ],
        resize_keyboard=True,
        one_time_keyboard=False,
        input_field_placeholder="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–∫–æ–º..."
    )
    return keyboard

def get_test_keyboard(question_num: int, total_questions: int) -> ReplyKeyboardMarkup:
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="–∞"),
                KeyboardButton(text="–±"),
            ],
            [
                KeyboardButton(text="–≤"),
                KeyboardButton(text="–≥"),
            ],
            [
                KeyboardButton(text="‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"),
                KeyboardButton(text=f"üìù {question_num}/{total_questions}"),
                KeyboardButton(text="üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç")
            ],
            [
                KeyboardButton(text="üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"),
            ]
        ],
        resize_keyboard=True,
        one_time_keyboard=False,
        input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞..."
    )
    return keyboard

def get_lessons_list_keyboard() -> ReplyKeyboardMarkup:
    keyboard_rows = []
    
    for module in MODULES:
        audio_icon = "üéß " if module.get("has_audio", False) else ""
        keyboard_rows.append([
            KeyboardButton(text=f"{module['emoji']} {audio_icon}–î–µ–Ω—å {module['day']}: {module['title'][:20]}")
        ])
    
    keyboard_rows.append([
        KeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å"),
        KeyboardButton(text="üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    ])
    
    keyboard = ReplyKeyboardMarkup(
        keyboard=keyboard_rows,
        resize_keyboard=True,
        one_time_keyboard=False,
        input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫..."
    )
    return keyboard

def get_after_test_keyboard() -> ReplyKeyboardMarkup:
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å"),
                KeyboardButton(text="üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞")
            ],
            [
                KeyboardButton(text="üìö –ú–µ–Ω—é –∫—É—Ä—Å–∞"),
                KeyboardButton(text="üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
            ]
        ],
        resize_keyboard=True,
        one_time_keyboard=False,
        input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ..."
    )
    return keyboard

# =========== –ê–£–î–ò–û –ú–ï–ù–ï–î–ñ–ï–† ===========
class AudioManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞–º–∏"""
    
    def __init__(self, bot: Bot):
        self.bot = bot
    
    @staticmethod
    def get_audio_path(module_index: int) -> Optional[str]:
        """–ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É –º–æ–¥—É–ª—è"""
        if 0 <= module_index < len(MODULES):
            module = MODULES[module_index]
            audio_file = module.get("audio_file")
            if audio_file:
                audio_path = os.path.join(AUDIO_CONFIG["base_path"], audio_file)
                if os.path.exists(audio_path):
                    return audio_path
                else:
                    logger.warning(f"Audio file not found: {audio_path}")
        return None
    
    @staticmethod
    def audio_exists(module_index: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞"""
        return AudioManager.get_audio_path(module_index) is not None
    
    @staticmethod
    def get_audio_info(module_index: int) -> Dict:
        """–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞—É–¥–∏–æ –º–æ–¥—É–ª—è"""
        if 0 <= module_index < len(MODULES):
            module = MODULES[module_index]
            return {
                "file": module.get("audio_file"),
                "duration": module.get("audio_duration", 0),
                "title": module.get("audio_title", ""),
                "exists": AudioManager.audio_exists(module_index),
                "has_audio": module.get("has_audio", False)
            }
        return {}
    
    async def send_module_audio(self, chat_id: int, module_index: int, user_id: int) -> bool:
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –¥–ª—è –º–æ–¥—É–ª—è —Å inline-–∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏"""
        try:
            audio_path = AudioManager.get_audio_path(module_index)
            if not audio_path:
                logger.warning(f"No audio for module {module_index}")
                return False
            
            module = MODULES[module_index]
            audio_info = AudioManager.get_audio_info(module_index)
            
            audio_file = FSInputFile(audio_path)
            
            caption = f"üéß <b>{module['emoji']} –ê—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∫ –º–æ–¥—É–ª—é {module_index + 1}</b>\n"
            caption += f"<b>{module['title']}</b>\n\n"
            caption += f"‚è± <b>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</b> {audio_info['duration']//60}:{audio_info['duration']%60:02d}\n"
            caption += f"üìö <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {audio_info['title']}\n\n"
            
            is_completed = False
            if user_id in user_progress:
                is_completed = (module_index + 1) in user_progress[user_id].get('completed_modules', [])
            
            if is_completed:
                caption += "‚úÖ <b>–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —É–∂–µ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π</b>\n\n"
            else:
                caption += "üîò <b>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π –ø–æ—Å–ª–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è:</b>\n\n"
            
            caption += "<i>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ –¥–ª—è –ª—É—á—à–µ–≥–æ —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</i>"
            
            inline_kb = InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(
                    text="‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π", 
                    callback_data=f"done_{module_index}"
                )]
            ])
            
            await self.bot.send_audio(
                chat_id=chat_id,
                audio=audio_file,
                caption=caption,
                parse_mode=ParseMode.HTML,
                reply_markup=inline_kb
            )
            
            logger.info(f"Audio sent for module {module_index + 1} to chat {chat_id} with inline button")
            return True
            
        except Exception as e:
            logger.error(f"Error sending audio for module {module_index}: {e}")
            return False

audio_manager = AudioManager(bot)

# =========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===========
async def show_module(message: Message, module_index: int, state: FSMContext):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ
    """
    module = MODULES[module_index]
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –º–æ–¥—É–ª—é. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await state.set_state(UserState.viewing_module)
    await state.update_data(current_module=module_index)
    
    if user_id in user_progress:
        user_progress[user_id]['last_module'] = module_index
    
    module_text = f"{module['content']}\n\n"
    module_text += f"<b>üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</b> {module['task']}"
    
    is_completed = False
    if user_id in user_progress:
        is_completed = (module_index + 1) in user_progress[user_id].get('completed_modules', [])
    
    if not is_completed:
        module_text += "\n\n‚úÖ <b>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π –ø–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è!</b>"
        module_text += "\n<i>–ü–æ—Å–ª–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∞—É–¥–∏–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –∞—É–¥–∏–æ-—Å–æ–æ–±—â–µ–Ω–∏–∏ –≤—ã—à–µ</i>"
    
    await message.answer(
        module_text,
        reply_markup=get_lesson_navigation_keyboard(module_index, len(MODULES)),
        parse_mode=ParseMode.HTML
    )
    
    audio_sent = await audio_manager.send_module_audio(message.chat.id, module_index, user_id)
    
    if not audio_sent and module.get("has_audio", False):
        await message.answer(
            "‚ùå –ê—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode=ParseMode.HTML
        )

async def start_test_internal(message: Message, state: FSMContext):
    """
    –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    test_data = {
        "current_question": 0,
        "answers": {},
        "start_time": datetime.now().isoformat(),
        "completed": False,
        "skipped": []
    }
    
    await state.set_state(UserState.taking_test)
    await state.update_data(test_data=test_data)
    
    await send_test_question(message, state, 0)

async def send_test_question(message: Message, state: FSMContext, question_index: int = None):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞
    """
    data = await state.get_data()
    test_data = data.get("test_data", {})
    
    if question_index is None:
        question_index = test_data.get("current_question", 0)
    
    if question_index >= len(TEST_QUESTIONS):
        await finish_test(message, state)
        return
    
    question = TEST_QUESTIONS[question_index]
    
    question_text = f"<b>üìù –í–æ–ø—Ä–æ—Å {question_index + 1} –∏–∑ {len(TEST_QUESTIONS)}</b>\n\n"
    question_text += f"{question['question']}\n\n"
    
    for option_key, option_text in question["options"].items():
        question_text += f"<b>{option_key})</b> {option_text}\n"
    
    question_text += "\n<i>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ (–∞, –±, –≤, –≥)</i>"
    
    test_data["current_question"] = question_index
    await state.update_data(test_data=test_data)
    
    await message.answer(
        question_text,
        reply_markup=get_test_keyboard(question_index + 1, len(TEST_QUESTIONS)),
        parse_mode=ParseMode.HTML
    )

async def process_test_answer(message: Message, state: FSMContext, answer: str):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    test_data = data.get("test_data", {})
    current_question = test_data.get("current_question", 0)
    
    if current_question >= len(TEST_QUESTIONS):
        return
    
    question = TEST_QUESTIONS[current_question]
    test_data["answers"][question["id"]] = answer
    await state.update_data(test_data=test_data)
    
    next_question = current_question + 1
    
    if next_question < len(TEST_QUESTIONS):
        await send_test_question(message, state, next_question)
    else:
        await finish_test(message, state)

async def send_final_summary(message: Message):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∞—É–¥–∏–æ –∏ –∏—Ç–æ–≥–∏ –∫—É—Ä—Å–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        return
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ 8-–≥–æ –º–æ–¥—É–ª—è (–ø–æ–¥–∞—Ä–∫–∏)
    final_audio_sent = await audio_manager.send_module_audio(message.chat.id, 7, user_id)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ 8-–≥–æ –º–æ–¥—É–ª—è
    module = MODULES[7]
    module_text = module['content']
    
    await message.answer(
        module_text,
        parse_mode=ParseMode.HTML
    )
    
    if not final_audio_sent:
        await message.answer(
            "üéß <b>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</b> –ê—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –µ–≥–æ –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ –º–µ–Ω—é –∫—É—Ä—Å–∞.",
            parse_mode=ParseMode.HTML
        )

async def finish_test(message: Message, state: FSMContext):
    """
    –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ—Å—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    test_data = data.get("test_data", {})
    
    correct_answers = 0
    total_questions = len(TEST_QUESTIONS)
    results = []
    
    for question in TEST_QUESTIONS:
        question_id = question["id"]
        user_answer = test_data.get("answers", {}).get(question_id)
        correct_answer = question["correct"]
        
        is_correct = user_answer == correct_answer
        if is_correct:
            correct_answers += 1
        
        results.append({
            "question_id": question_id,
            "question": question["question"][:50] + "...",
            "user_answer": user_answer,
            "correct_answer": correct_answer,
            "correct_text": question["correct_text"],
            "is_correct": is_correct
        })
    
    percentage = (correct_answers / total_questions) * 100 if total_questions > 0 else 0
    
    if correct_answers >= 7:
        grade = "–û—Ç–ª–∏—á–Ω–æ! –í—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ —É—Å–≤–æ–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –∫—É—Ä—Å–∞ –∏ –≥–æ—Ç–æ–≤—ã –∫ –ø–µ—Ä–≤—ã–º —à–∞–≥–∞–º –≤ –º–∏—Ä–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤."
    elif correct_answers >= 5:
        grade = "–•–æ—Ä–æ—à–æ. –í—ã –ø–æ–Ω—è–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –µ—â–µ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏, –≥–¥–µ –±—ã–ª–∏ –¥–æ–ø—É—â–µ–Ω—ã –æ—à–∏–±–∫–∏."
    else:
        grade = "–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ! –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º —ç–∫—Å–ø—Ä–µ—Å—Å-–∫—É—Ä—Å–∞ –∏ —É–¥–µ–ª–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–º (–º–æ–¥—É–ª–∏ 1-3). –ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É!"
    
    if user_id not in user_progress:
        user_progress[user_id] = {}
    
    test_result = {
        "date": datetime.now().isoformat(),
        "correct_answers": correct_answers,
        "total_questions": total_questions,
        "percentage": percentage,
        "grade": grade,
        "results": results
    }
    
    user_progress[user_id]["test_results"] = user_progress[user_id].get("test_results", [])
    user_progress[user_id]["test_results"].append(test_result)
    
    save_user_progress()
    
    result_text = f"""
<b>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</b>

‚úÖ <b>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</b> {correct_answers} –∏–∑ {total_questions}
üìä <b>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</b> {percentage:.1f}%
‚≠ê <b>–û—Ü–µ–Ω–∫–∞:</b> {correct_answers}/{total_questions}

<b>{grade}</b>

<b>üìã –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b>
"""
    
    for i, result in enumerate(results, 1):
        status = "‚úÖ" if result["is_correct"] else "‚ùå"
        result_text += f"\n{status} <b>–í–æ–ø—Ä–æ—Å {i}:</b>"
        result_text += f"\n–í–∞—à –æ—Ç–≤–µ—Ç: <b>{result['user_answer'] if result['user_answer'] else '–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞'}</b>"
        result_text += f"\n–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π: <b>{result['correct_text']}</b>\n"
    
    result_text += f"\n<b>üìÖ –î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:</b> {datetime.now().strftime('%d.%m.%Y %H:%M')}"
    result_text += "\n\n<b>üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>"
    result_text += "\n‚Ä¢ –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –º–æ–¥—É–ª–∏ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ"
    result_text += "\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–∞—Ö"
    result_text += "\n‚Ä¢ –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É"
    
    if correct_answers >= 5:
        result_text += "\n\nüéâ <b>–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú –° –£–°–ü–ï–®–ù–´–ú –ü–†–û–•–û–ñ–î–ï–ù–ò–ï–ú –ö–£–†–°–ê –ò –¢–ï–°–¢–ê!</b> üéâ"
        result_text += "\n\n‚úÖ –í—ã –æ—Å–≤–æ–∏–ª–∏ –æ—Å–Ω–æ–≤—ã —Ç–µ–Ω–¥–µ—Ä–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã"
        result_text += "\n‚úÖ –í—ã –≥–æ—Ç–æ–≤—ã –∫ –ø–µ—Ä–≤—ã–º —à–∞–≥–∞–º –≤ –º–∏—Ä–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤"
        result_text += "\n‚úÖ –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π"
        result_text += "\n‚úÖ –í—ã –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –∏—Å–∫–∞—Ç—å –∑–∞–∫—É–ø–∫–∏ –∏ –∫–∞–∫ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
        result_text += "\n\n<b>–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å! –ü–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π!</b>"
    
    await message.answer(
        result_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_after_test_keyboard()
    )
    
    # –£–±—Ä–∞–ª–∏ –≤—ã–∑–æ–≤ send_final_summary, —á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è –î–µ–Ω—å 8 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
    # await send_final_summary(message)
    
    await state.clear()

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò CALLBACK QUERY ===========
@dp.callback_query(lambda c: c.data.startswith('done_'))
async def handle_mark_completed_callback(callback_query: CallbackQuery, state: FSMContext):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π" –≤ –∞—É–¥–∏–æ-—Å–æ–æ–±—â–µ–Ω–∏–∏
    """
    user_id = callback_query.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await callback_query.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            show_alert=True
        )
        return
    
    try:
        module_index = int(callback_query.data.split('_')[-1])
    except ValueError:
        await callback_query.answer(
            "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞.",
            show_alert=True
        )
        return
    
    if module_index < 0 or module_index >= len(MODULES):
        await callback_query.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –º–æ–¥—É–ª—è.",
            show_alert=True
        )
        return
    
    if user_id not in user_progress:
        user_progress[user_id] = {
            'start_date': datetime.now().isoformat(),
            'completed_modules': [],
            'last_module': module_index,
            'name': callback_query.from_user.first_name,
            'audio_listened': [],
            'test_results': []
        }
    
    module_num = module_index + 1
    
    if module_num in user_progress[user_id]['completed_modules']:
        await callback_query.answer(
            "‚ÑπÔ∏è –≠—Ç–æ—Ç –º–æ–¥—É–ª—å —É–∂–µ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π!",
            show_alert=True
        )
        return
    
    user_progress[user_id]['completed_modules'].append(module_num)
    
    if module_num not in user_progress[user_id].get('audio_listened', []):
        user_progress[user_id].setdefault('audio_listened', []).append(module_num)
    
    user_progress[user_id]['last_module'] = module_index
    
    save_user_progress()
    
    await callback_query.answer(
        f"‚úÖ –ú–æ–¥—É–ª—å {module_num} —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π!",
        show_alert=True
    )
    
    try:
        module = MODULES[module_index]
        audio_info = AudioManager.get_audio_info(module_index)
        
        updated_caption = f"üéß <b>{module['emoji']} –ê—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∫ –º–æ–¥—É–ª—é {module_index + 1}</b>\n"
        updated_caption += f"<b>{module['title']}</b>\n\n"
        updated_caption += f"‚è± <b>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</b> {audio_info['duration']//60}:{audio_info['duration']%60:02d}\n"
        updated_caption += f"üìö <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {audio_info['title']}\n\n"
        updated_caption += "‚úÖ <b>–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π!</b>\n\n"
        updated_caption += "<i>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ –µ—â–µ —Ä–∞–∑ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</i>"
        
        await callback_query.message.edit_caption(
            caption=updated_caption,
            parse_mode=ParseMode.HTML,
            reply_markup=None
        )
        
    except Exception as e:
        logger.error(f"Error updating audio message: {e}")
    
    completed = len(user_progress[user_id]['completed_modules'])
    total = len(MODULES)
    
    if completed >= 7 and not user_progress[user_id].get('test_results'):
        try:
            await callback_query.message.answer(
                "üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞!</b>\n\n"
                "üìù <b>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π:</b>\n"
                "1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è\n"
                "2. –ü–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É\n"
                "3. –£–≤–∏–¥–µ—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é\n\n"
                "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!",
                parse_mode=ParseMode.HTML
            )
        except:
            pass
    elif completed == total:
        try:
            await callback_query.message.answer(
                "üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å–µ –º–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞, –≤–∫–ª—é—á–∞—è –±–æ–Ω—É—Å–Ω—ã–π!</b>\n\n"
                "üìù <b>–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!</b>\n"
                "üéÅ <b>–ê –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ—à–ª–∏, —Ç–æ –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –ø–æ–¥–∞—Ä–∫–∏ –≤ 8 –¥–Ω–µ!</b>",
                parse_mode=ParseMode.HTML
            )
        except:
            pass

# =========== –ö–û–ú–ê–ù–î–´ ===========
@dp.message(Command("start"))
async def cmd_start(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    """
    user_id = message.from_user.id
    user_name = message.from_user.first_name
    
    if user_id not in user_progress:
        user_progress[user_id] = {
            'start_date': datetime.now().isoformat(),
            'completed_modules': [],
            'last_module': 0,
            'name': user_name,
            'audio_listened': [],
            'test_results': []
        }
        save_user_progress()
    
    is_paid = access_control.is_paid_user(user_id)
    is_admin = access_control.is_admin(user_id)
    
    if is_admin:
        admin_badge = " üëë"
        
        if is_paid:
            welcome_text = f"""
<b>üëë –ü—Ä–∏–≤–µ—Ç, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {user_name}!</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç —Å <b>–ø–æ–ª–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</b>!

<b>–í–∞—à–∏ –ø—Ä–∞–≤–∞:</b>
‚Ä¢ üìö –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º {len(MODULES)} —É—Ä–æ–∫–∞–º –∫—É—Ä—Å–∞
‚Ä¢ üéß –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞—É–¥–∏–æ-—É—Ä–æ–∫–æ–≤
‚Ä¢ üìù –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
‚Ä¢ üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞
‚Ä¢ üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ üìä –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚Ä¢ üì¢ –†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏!</b>
"""
            keyboard = get_main_keyboard(user_id)
        else:
            welcome_text = f"""
<b>üëë –ü—Ä–∏–≤–µ—Ç, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {user_name}!</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º!

<b>–í–∞—à–∏ –ø—Ä–∞–≤–∞:</b>
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚Ä¢ –†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</b>
"""
            keyboard = get_admin_keyboard()
            
    elif is_paid:
        welcome_text = f"""
<b>üëã –ü—Ä–∏–≤–µ—Ç, {user_name}!</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ <b>–≠–∫—Å–ø—Ä–µ—Å—Å-–∫—É—Ä—Å: "–¢–µ–Ω–¥–µ—Ä—ã —Å –Ω—É–ª—è"</b>!

üéØ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫—É—Ä—Å–∞:</b>
‚Ä¢ üìö –í–∫–ª—é—á–∞–µ—Ç {len(MODULES)} –º–æ–¥—É–ª–µ–π
‚Ä¢ üéß <b>–ê—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∫ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–∫—É</b>
‚Ä¢ üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚Ä¢ <b>üìù –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç</b> –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π
‚Ä¢ üéÅ <b>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤</b> (8-–π –¥–µ–Ω—å)

<b>üéß –í–∞–∂–Ω–æ!</b> –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Ä–æ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ <b>—Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –º–æ–¥—É–ª—è –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ</b>.

<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏!</b>
"""
        keyboard = get_main_keyboard(user_id)
        
    else:
        welcome_text = f"""
<b>üëã –ü—Ä–∏–≤–µ—Ç, {user_name}!</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ <b>–≠–∫—Å–ø—Ä–µ—Å—Å-–∫—É—Ä—Å: "–¢–µ–Ω–¥–µ—Ä—ã —Å –Ω—É–ª—è"</b>!

üöÄ <b>–ö—É—Ä—Å –≤–∫–ª—é—á–∞–µ—Ç:</b>
‚Ä¢ {len(MODULES)} –º–æ–¥—É–ª–µ–π —Å –∞—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ–º
‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
‚Ä¢ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã
‚Ä¢ üéÅ –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤

üîí <b>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:</b>
1. –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
2. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> 
   <s>3 999 —Ä—É–±. –≤–º–µ—Å—Ç–æ 5 000 —Ä—É–±.</s> 
   <b>*–ê–∫—Ü–∏—è –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞

üìû <b>–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:</b>
–¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['mobile']}
Email: {ADDITIONAL_MATERIALS['contacts']['email']}
–¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}

<b>–ù–∞–∂–º–∏—Ç–µ "üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø" –¥–ª—è –æ–ø–ª–∞—Ç—ã!</b>
"""
        keyboard = get_main_keyboard(user_id)
    
    await message.answer(
        welcome_text,
        reply_markup=keyboard,
        parse_mode=ParseMode.HTML
    )
    
    await state.clear()

@dp.message(Command("admin"))
async def cmd_admin(message: Message):
    """
    –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    admin_text = f"""
<b>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>

üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>
‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(access_control.get_all_admins())}
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º: {len(access_control.get_all_paid_users())}
‚Ä¢ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞: {len(user_progress)}
‚Ä¢ –ú–æ–¥—É–ª–µ–π –≤ –∫—É—Ä—Å–µ: {len(MODULES)}

‚öôÔ∏è <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
‚Ä¢ <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</b> - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</b> - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚Ä¢ <b>–†–∞—Å—Å—ã–ª–∫–∞</b> - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
‚Ä¢ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

<b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>
"""
    
    await message.answer(
        admin_text,
        reply_markup=get_admin_keyboard(),
        parse_mode=ParseMode.HTML
    )

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê ===========
@dp.message(F.text == "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º")
async def handle_access_management(message: Message):
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    access_text = f"""
<b>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</b>

üìã <b>–¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>
‚Ä¢ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º: {len(access_control.get_all_paid_users())}
‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(access_control.get_all_admins())}

üîß <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</b>
‚Ä¢ <b>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b> - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø
‚Ä¢ <b>–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b> - –æ—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø
‚Ä¢ <b>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏</b> - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

<b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>
"""
    
    await message.answer(
        access_text,
        reply_markup=get_access_management_keyboard(),
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
async def handle_add_user_start(message: Message, state: FSMContext):
    """
    –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await state.set_state(UserState.admin_add_user)
    await message.answer(
        "<b>‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ <b>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b> –∏–ª–∏ <b>@username</b> –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.\n\n"
        "<i>–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–∂–º–∏—Ç–µ /cancel</i>",
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "‚ûñ –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
async def handle_remove_user_start(message: Message, state: FSMContext):
    """
    –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await state.set_state(UserState.admin_remove_user)
    await message.answer(
        "<b>‚ûñ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ <b>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b> –∏–ª–∏ <b>@username</b> –¥–ª—è –æ—Ç–∑—ã–≤–∞ –¥–æ—Å—Ç—É–ø–∞.\n\n"
        "<i>–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–∂–º–∏—Ç–µ /cancel</i>",
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
async def handle_list_users(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    paid_users = access_control.get_all_paid_users()
    admins = access_control.get_all_admins()
    
    if not paid_users:
        await message.answer(
            "üìã <b>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—É—Å—Ç.</b>",
            parse_mode=ParseMode.HTML
        )
        return
    
    users_text = "<b>üìã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º:</b>\n\n"
    
    for i, user_id in enumerate(paid_users[:50], 1):
        is_admin = user_id in admins
        admin_badge = " üëë" if is_admin else ""
        users_text += f"{i}. ID: <code>{user_id}</code>{admin_badge}\n"
    
    if len(paid_users) > 50:
        users_text += f"\n<i>... –∏ –µ—â–µ {len(paid_users) - 50} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</i>"
    
    users_text += f"\n\n<b>–í—Å–µ–≥–æ: {len(paid_users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</b>"
    
    await message.answer(
        users_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_access_management_keyboard()
    )

@dp.message(F.text == "üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏")
async def handle_admin_management(message: Message):
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    admins = access_control.get_all_admins()
    
    admin_text = f"""
<b>üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</b>

üìã <b>–¢–µ–∫—É—â–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã ({len(admins)}):</b>
"""
    
    for i, admin_id in enumerate(admins, 1):
        admin_text += f"{i}. ID: <code>{admin_id}</code>\n"
    
    admin_text += "\n<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</b>"
    
    await message.answer(
        admin_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_admin_management_keyboard()
    )

@dp.message(F.text == "üëë –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
async def handle_add_admin_start(message: Message, state: FSMContext):
    """
    –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await message.answer(
        "<b>üëë –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ <b>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b> –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.\n\n"
        "<i>–í–Ω–∏–º–∞–Ω–∏–µ: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –±–æ—Ç–æ–º!</i>\n\n"
        "<i>–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–∂–º–∏—Ç–µ /cancel</i>",
        parse_mode=ParseMode.HTML
    )
    
    await state.set_state(UserState.admin_add_user)
    await state.update_data(is_admin=True)

@dp.message(F.text == "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
async def handle_remove_admin_start(message: Message, state: FSMContext):
    """
    –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    admins = access_control.get_all_admins()
    
    if len(admins) <= 1:
        await message.answer(
            "‚ùå <b>–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!</b>",
            parse_mode=ParseMode.HTML,
            reply_markup=get_admin_management_keyboard()
        )
        return
    
    await message.answer(
        "<b>üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ <b>ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b> –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.\n\n"
        "<i>–í–Ω–∏–º–∞–Ω–∏–µ: –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!</i>\n\n"
        "<i>–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–∂–º–∏—Ç–µ /cancel</i>",
        parse_mode=ParseMode.HTML
    )
    
    await state.set_state(UserState.admin_remove_user)
    await state.update_data(is_admin=True)

@dp.message(F.text == "üìã –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤")
async def handle_list_admins(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    admins = access_control.get_all_admins()
    
    admins_text = "<b>üëë –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</b>\n\n"
    
    for i, admin_id in enumerate(admins, 1):
        admins_text += f"{i}. ID: <code>{admin_id}</code>\n"
    
    admins_text += f"\n<b>–í—Å–µ–≥–æ: {len(admins)} –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</b>"
    
    await message.answer(
        admins_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_admin_management_keyboard()
    )

@dp.message(F.text == "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
async def handle_statistics(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ—Ç–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    total_users = len(user_progress)
    paid_users = len(access_control.get_all_paid_users())
    admins = len(access_control.get_all_admins())
    
    completed_courses = 0
    active_users = 0
    
    for user_data in user_progress.values():
        completed_modules = len(user_data.get('completed_modules', []))
        if completed_modules >= len(MODULES):
            completed_courses += 1
        if completed_modules > 0:
            active_users += 1
    
    stats_text = f"""
<b>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞</b>

üë• <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</b>
‚Ä¢ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º: {paid_users}
‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {admins}
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {active_users}

üìö <b>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è:</b>
‚Ä¢ –ó–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é: {completed_courses}
‚Ä¢ –ü—Ä–æ—Ö–æ–¥—è—Ç –æ–±—É—á–µ–Ω–∏–µ: {active_users - completed_courses}
‚Ä¢ –ú–æ–¥—É–ª–µ–π –≤ –∫—É—Ä—Å–µ: {len(MODULES)}

üéØ <b>–ö—É—Ä—Å:</b>
‚Ä¢ –ú–æ–¥—É–ª–µ–π: {len(MODULES)}
‚Ä¢ –ê—É–¥–∏–æ —É—Ä–æ–∫–æ–≤: {sum(1 for m in MODULES if m.get('has_audio'))}
‚Ä¢ –í–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ—Å—Ç–µ: {len(TEST_QUESTIONS)}

üìÖ <b>–°–∏—Å—Ç–µ–º–∞:</b>
‚Ä¢ –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤: {restart_count}
"""
    
    await message.answer(
        stats_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_admin_keyboard()
    )

@dp.message(F.text == "üì¢ –†–∞—Å—Å—ã–ª–∫–∞")
async def handle_broadcast_start(message: Message, state: FSMContext):
    """
    –ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await message.answer(
        "<b>üì¢ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏</b>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Ä–∞–∑–æ—Å–ª–∞–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –¥–æ—Å—Ç—É–ø–æ–º.\n\n"
        "<i>–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTML —Ä–∞–∑–º–µ—Ç–∫—É –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</i>\n\n"
        "<i>–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–∂–º–∏—Ç–µ /cancel</i>",
        parse_mode=ParseMode.HTML
    )
    
    await state.update_data(broadcast=True)

@dp.message(F.text == "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")
async def handle_settings(message: Message):
    """
    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
    """
    user_id = message.from_user.id
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    settings_text = f"""
<b>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</b>

üîß <b>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</b>
‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤: {max_restarts}
‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏: {restart_delay} —Å–µ–∫
‚Ä¢ HTTP –ø–æ—Ä—Ç: {PORT}
‚Ä¢ –ú–æ–¥—É–ª–µ–π –≤ –∫—É—Ä—Å–µ: {len(MODULES)}

üìÅ <b>–§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö:</b>
‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã: {len(access_control.get_all_admins())} –∑–∞–ø–∏—Å–µ–π
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: {len(access_control.get_all_paid_users())} –∑–∞–ø–∏—Å–µ–π
‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å: {len(user_progress)} –∑–∞–ø–∏—Å–µ–π

üîÑ <b>–î–µ–π—Å—Ç–≤–∏—è:</b>
‚Ä¢ /backup - –°–æ–∑–¥–∞—Ç—å backup –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ /restore - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
‚Ä¢ /cleanup - –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
"""
    
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="üîô –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É"),
            ]
        ],
        resize_keyboard=True
    )
    
    await message.answer(
        settings_text,
        parse_mode=ParseMode.HTML,
        reply_markup=keyboard
    )

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–°–¢–û–Ø–ù–ò–ô –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê ===========
@dp.message(UserState.admin_add_user)
async def handle_admin_add_user_process(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    """
    user_id = message.from_user.id
    target = message.text.strip()
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        await state.clear()
        return
    
    data = await state.get_data()
    is_adding_admin = data.get('is_admin', False)
    
    try:
        target_id = None
        
        if target.isdigit():
            target_id = int(target)
        elif target.startswith('@'):
            try:
                user = await bot.get_chat(target)
                target_id = user.id
            except Exception as e:
                await message.answer(
                    f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {target}\n"
                    f"–û—à–∏–±–∫–∞: {str(e)}",
                    reply_markup=get_access_management_keyboard() if not is_adding_admin else get_admin_management_keyboard()
                )
                await state.clear()
                return
        else:
            await message.answer(
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–∏—Å–ª–æ) –∏–ª–∏ @username",
                reply_markup=get_access_management_keyboard() if not is_adding_admin else get_admin_management_keyboard()
            )
            return
        
        if is_adding_admin:
            if access_control.add_admin(target_id):
                await message.answer(
                    f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: <code>{target_id}</code> –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_admin_management_keyboard()
                )
                
                try:
                    await bot.send_message(
                        target_id,
                        "üéâ <b>–í–∞—Å –Ω–∞–∑–Ω–∞—á–∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –±–æ—Ç–∞!</b>\n\n"
                        "–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.\n"
                        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /admin –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.",
                        parse_mode=ParseMode.HTML
                    )
                except:
                    pass
            else:
                await message.answer(
                    f"‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: <code>{target_id}</code> —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_admin_management_keyboard()
                )
        else:
            if access_control.add_paid_user(target_id):
                await message.answer(
                    f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ID: <code>{target_id}</code> –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É!",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_access_management_keyboard()
                )
                
                try:
                    await bot.send_message(
                        target_id,
                        "üéâ <b>–í–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É!</b>\n\n"
                        "–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.\n"
                        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –∫—É—Ä—Å–æ–º.",
                        parse_mode=ParseMode.HTML
                    )
                except:
                    pass
            else:
                await message.answer(
                    f"‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: <code>{target_id}</code> —É–∂–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É.",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_access_management_keyboard()
                )
    
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID. ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.",
            reply_markup=get_access_management_keyboard() if not is_adding_admin else get_admin_management_keyboard()
        )
    except Exception as e:
        logger.error(f"Error adding user: {e}")
        await message.answer(
            f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {str(e)}",
            reply_markup=get_access_management_keyboard() if not is_adding_admin else get_admin_management_keyboard()
        )
    
    await state.clear()

@dp.message(UserState.admin_remove_user)
async def handle_admin_remove_user_process(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    """
    user_id = message.from_user.id
    target = message.text.strip()
    
    if not access_control.is_admin(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
            reply_markup=get_main_keyboard(user_id)
        )
        await state.clear()
        return
    
    data = await state.get_data()
    is_removing_admin = data.get('is_admin', False)
    
    try:
        target_id = None
        
        if target.isdigit():
            target_id = int(target)
        elif target.startswith('@'):
            try:
                user = await bot.get_chat(target)
                target_id = user.id
            except Exception as e:
                await message.answer(
                    f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {target}\n"
                    f"–û—à–∏–±–∫–∞: {str(e)}",
                    reply_markup=get_access_management_keyboard() if not is_removing_admin else get_admin_management_keyboard()
                )
                await state.clear()
                return
        else:
            await message.answer(
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–∏—Å–ª–æ) –∏–ª–∏ @username",
                reply_markup=get_access_management_keyboard() if not is_removing_admin else get_admin_management_keyboard()
            )
            return
        
        if is_removing_admin:
            if target_id == user_id:
                await message.answer(
                    "‚ùå <b>–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è –∏–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤!</b>",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_admin_management_keyboard()
                )
                return
            
            if access_control.remove_admin(target_id):
                await message.answer(
                    f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: <code>{target_id}</code> —É–¥–∞–ª–µ–Ω –∏–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤!",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_admin_management_keyboard()
                )
            else:
                await message.answer(
                    f"‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: <code>{target_id}</code> –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_admin_management_keyboard()
                )
        else:
            if access_control.remove_paid_user(target_id):
                await message.answer(
                    f"‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: <code>{target_id}</code> –æ—Ç–æ–∑–≤–∞–Ω –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É!",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_access_management_keyboard()
                )
            else:
                await message.answer(
                    f"‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: <code>{target_id}</code> –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É.",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_access_management_keyboard()
                )
    
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID. ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.",
            reply_markup=get_access_management_keyboard() if not is_removing_admin else get_admin_management_keyboard()
        )
    except Exception as e:
        logger.error(f"Error removing user: {e}")
        await message.answer(
            f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {str(e)}",
            reply_markup=get_access_management_keyboard() if not is_removing_admin else get_admin_management_keyboard()
        )
    
    await state.clear()

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –î–û–°–¢–£–ü–ê –° QR-–ö–û–î–û–ú ===========
@dp.message(F.text == "üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø")
async def handle_get_access(message: Message):
    """
    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–∞ —Å QR-–∫–æ–¥–æ–º –¥–ª—è –æ–ø–ª–∞—Ç—ã
    """
    user_id = message.from_user.id
    user_name = message.from_user.first_name
    username = message.from_user.username or "–Ω–µ —É–∫–∞–∑–∞–Ω"
    
    if access_control.is_paid_user(user_id):
        await message.answer(
            "‚úÖ –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É!",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    access_info = f"""
<b>üîì –ü–û–õ–£–ß–ï–ù–ò–ï –î–û–°–¢–£–ü–ê –ö –ö–£–†–°–£</b>

‚ú® <b>üéÅ –ê–ö–¶–ò–Ø: 3 999 —Ä—É–±. –≤–º–µ—Å—Ç–æ </b><s>5 000 —Ä—É–±.</s>
<b>*–ê–∫—Ü–∏—è –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞!</b>
---
<b>üìã –ß–¢–û –í–•–û–î–ò–¢ –í –ö–£–†–°:</b>

‚úÖ <b>{len(MODULES)} –º–æ–¥—É–ª–µ–π —Å –∞—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ–º:</b>
   ‚Ä¢ üìö –û—Å–Ω–æ–≤—ã –º–∏—Ä–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤
   ‚Ä¢ üèõÔ∏è –†–∞–±–æ—Ç–∞ —Å 44-–§–ó
   ‚Ä¢ üè¢ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏ (223-–§–ó)
   ‚Ä¢ üíº –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã
   ‚Ä¢ üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö
   ‚Ä¢ üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç
   ‚Ä¢ üèÜ –ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞
   ‚Ä¢ üéÅ –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤

‚úÖ <b>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</b>
   ‚Ä¢ üéß –ê—É–¥–∏–æ-–ø–æ—è—Å–Ω–µ–Ω–∏—è –∫ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–∫—É
   ‚Ä¢ üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
   ‚Ä¢ ‚úÖ –ö–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   ‚Ä¢ üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   ‚Ä¢ üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –æ—Ü–µ–Ω–∫–æ–π –∑–Ω–∞–Ω–∏–π
   ‚Ä¢ üì• –ì–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç
   ‚Ä¢ üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

---
<b>üìù –°–û–ì–õ–ê–°–ò–ï –ù–ê –û–ë–†–ê–ë–û–¢–ö–£ –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•:</b>

–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É "üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø", –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ:
1. –û–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
2. –°–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –í–∞—à–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —É—Å–ª–æ–≤–∏—è –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥

üìÑ <a href="https://tritika.ru/privacy-policy/">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ tritika.ru</a>
---
<b>üí≥ –°–ü–û–°–û–ë –û–ü–õ–ê–¢–´:</b>

1. <b>–ü–µ—Ä–µ–≤–æ–¥ –ø–æ QR-–∫–æ–¥—É</b> (—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∫–æ–¥ –Ω–∏–∂–µ)
---
<b>ü§ù –ü–û–°–õ–ï –û–ü–õ–ê–¢–´:</b>

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ
2. –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram –∏–ª–∏ –Ω–∞ email
3. –£–∫–∞–∂–∏—Ç–µ –≤–∞—à ID: <code>{user_id}</code>
4. –ú—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∞—à –¥–æ—Å—Ç—É–ø –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤

<b>üìû –ö–û–ù–¢–ê–ö–¢–´:</b>
–¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['mobile']}
Email: {ADDITIONAL_MATERIALS['contacts']['email']}
–°–∞–π—Ç: {ADDITIONAL_MATERIALS['contacts']['website']}
–¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}

<b>üÜî –í–∞—à ID –¥–ª—è —Å–≤—è–∑–∏: <code>{user_id}</code></b>

<b>üì± –ö–ê–ö –ù–ê–ñ–ê–¢–¨ –ö–ù–û–ü–ö–£:</b>
–í–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ –Ω–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>"üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø"</b> –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–ø–ª–∞—Ç–µ.
"""
    
    await message.answer(
        access_info,
        parse_mode=ParseMode.HTML,
        disable_web_page_preview=True,
        reply_markup=get_main_keyboard(user_id)
    )
    
    qr_code_path = "qr_code.png"
    if os.path.exists(qr_code_path):
        try:
            photo = FSInputFile(qr_code_path)
            caption = "<b>üì± QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã 3 999 —Ä—É–±.</b>\n\n"
            caption += "1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –±–∞–Ω–∫–∞\n"
            caption += "2. –ù–∞–∂–º–∏—Ç–µ ¬´–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ QR-–∫–æ–¥—É¬ª\n"
            caption += "3. –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –∫–æ–¥\n"
            caption += "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É–º–º—É: <b>3 999 —Ä—É–±.</b>\n"
            caption += "5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–ª–∞—Ç–µ–∂\n\n"
            caption += "‚úÖ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫ –Ω–∞ –ø–æ—á—Ç—É info@tritika.ru"
            
            await message.answer_photo(
                photo=photo,
                caption=caption,
                parse_mode=ParseMode.HTML
            )
        except Exception as e:
            logger.error(f"Error sending QR code: {e}")
            await message.answer(
                "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å QR-–∫–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤.",
                parse_mode=ParseMode.HTML
            )
    else:
        await message.answer(
            "<b>üí≥ –†–ï–ö–í–ò–ó–ò–¢–´ –î–õ–Ø –û–ü–õ–ê–¢–´:</b>\n\n"
            "<b>–°—É–º–º–∞:</b> 3 999 —Ä—É–±.\n\n"
            "<b>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</b> –û–û–û ¬´–¢—Ä–∏—Ç–∏–∫–∞¬ª\n"
            "<b>–ò–ù–ù:</b> 1234567890\n"
            "<b>–ë–∞–Ω–∫:</b> –ü–ê–û –°–±–µ—Ä–±–∞–Ω–∫\n"
            "<b>–ë–ò–ö:</b> 044525225\n"
            "<b>–°—á–µ—Ç:</b> 40702810012345678901\n"
            "<b>–ö–æ—Ä—Ä. —Å—á–µ—Ç:</b> 30101810400000000225\n\n"
            "<b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:</b> –û–ø–ª–∞—Ç–∞ –∫—É—Ä—Å–∞ ¬´–¢–µ–Ω–¥–µ—Ä—ã —Å –Ω—É–ª—è¬ª\n\n"
            "<b>–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:</b>\n"
            f"–¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}\n"
            f"Email: {ADDITIONAL_MATERIALS['contacts']['email']}\n"
            f"–¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['mobile']}\n\n"
            "‚úÖ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –≤ —ç—Ç–æ—Ç —á–∞—Ç",
            parse_mode=ParseMode.HTML
        )
    
    admins = access_control.get_all_admins()
    notification_sent = False
    
    for admin_id in admins:
        try:
            admin_message = f"""
üîî <b>–ù–û–í–´–ô –ó–ê–ü–†–û–° –ù–ê –î–û–°–¢–£–ü</b>

üë§ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</b>
‚Ä¢ ID: <code>{user_id}</code>
‚Ä¢ –ò–º—è: {user_name}
‚Ä¢ –ù–∏–∫–Ω–µ–π–º: @{username}
‚Ä¢ –í—Ä–µ–º—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

üí∞ <b>–¢–∏–ø –¥–æ—Å—Ç—É–ø–∞:</b> –ü–æ–ª–Ω—ã–π –∫—É—Ä—Å (3 999 —Ä—É–±. –ø–æ –∞–∫—Ü–∏–∏)
üìã <b>–°—Ç–∞—Ç—É—Å:</b> –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã

<b>–î–µ–π—Å—Ç–≤–∏—è:</b>
1. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –£–≤–µ–¥–æ–º–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–± –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞

<b>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</b>
–ù–∞–∂–º–∏—Ç–µ ¬´üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º¬ª ‚Üí ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è¬ª ‚Üí –í–≤–µ–¥–∏—Ç–µ ID: <code>{user_id}</code>
"""
            await bot.send_message(admin_id, admin_message, parse_mode=ParseMode.HTML)
            notification_sent = True
            logger.info(f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É {admin_id}")
        except Exception as e:
            logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É {admin_id}: {e}")
    
    if notification_sent:
        await message.answer(
            "‚úÖ <b>–í–∞—à –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º!</b>\n\n"
            "–û–Ω–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω—ã –æ –≤–∞—à–µ–º –∂–µ–ª–∞–Ω–∏–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É.\n\n"
            "üìû <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</b>\n"
            "1. –ü—Ä–æ–∏–∑–≤–µ–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—É –ø–æ QR-–∫–æ–¥—É\n"
            "2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —á–µ–∫/—Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã\n"
            "3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫ –≤ —ç—Ç–æ—Ç —á–∞—Ç\n"
            "4. –û–∂–∏–¥–∞–π—Ç–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ (–¥–æ 24 —á–∞—Å–æ–≤)\n\n"
            "‚åõ <b>–û–±—ã—á–Ω–æ –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —á–∞—Å–æ–≤</b>",
            parse_mode=ParseMode.HTML
        )
    else:
        await message.answer(
            "‚ö†Ô∏è <b>–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º</b>\n\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é:\n"
            f"–¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['mobile']}\n"
            f"Email: {ADDITIONAL_MATERIALS['contacts']['email']}\n"
            f"–°–∞–π—Ç: {ADDITIONAL_MATERIALS['contacts']['website']}\n"
            f"–¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}\n\n"
            "–°–æ–æ–±—â–∏—Ç–µ –≤–∞—à ID –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:\n"
            f"<code>{user_id}</code>",
            parse_mode=ParseMode.HTML
        )

@dp.message(F.text == "‚ÑπÔ∏è –û –∫—É—Ä—Å–µ")
async def handle_about_course(message: Message):
    """
    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—Å–µ
    """
    user_id = message.from_user.id
    
    about_text = f"""
<b>üéì –≠–ö–°–ü–†–ï–°–°-–ö–£–†–° ¬´–¢–ï–ù–î–ï–†–´ –° –ù–£–õ–Ø¬ª</b>

<b>üéØ –¶–ï–õ–¨ –ö–£–†–°–ê:</b>
–ù–∞—É—á–∏—Ç—å –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö —Å –Ω—É–ª—è –¥–æ –ø–µ—Ä–≤–æ–π –ø–æ–±–µ–¥—ã.

<b>üìö –ß–¢–û –í–´ –ü–û–õ–£–ß–ò–¢–ï:</b>

‚úÖ <b>{len(MODULES)} —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:</b>
1. üìö –û—Å–Ω–æ–≤—ã –º–∏—Ä–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤
2. üèõÔ∏è –†–∞–±–æ—Ç–∞ —Å 44-–§–ó (–≥–æ—Å–∑–∞–∫—É–ø–∫–∏)
3. üè¢ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏ (223-–§–ó)
4. üíº –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã
5. üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö
6. üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç
7. üèÜ –ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞
8. üéÅ –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤

‚úÖ <b>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è:</b>
‚Ä¢ üéß –ê—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∫ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–∫—É
‚Ä¢ ‚úÖ Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚Ä¢ üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
‚Ä¢ üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚Ä¢ üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –æ—Ü–µ–Ω–∫–æ–π –∑–Ω–∞–Ω–∏–π
‚Ä¢ üì• –ì–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –≤ Word-—Ñ–æ—Ä–º–∞—Ç–µ
‚Ä¢ üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

‚úÖ <b>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b>
‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É 44-–§–ó, 223-–§–ó –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ —Ç–µ–Ω–¥–µ—Ä–∞–º–∏
‚Ä¢ –ó–Ω–∞–Ω–∏–µ –≥–¥–µ –∏ –∫–∞–∫ –∏—Å–∫–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä—ã
‚Ä¢ –£–º–µ–Ω–∏–µ –∏–∑—É—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö
‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤
‚Ä¢ –ß–µ–∫-–ª–∏—Å—Ç –∏–∑ 10 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤

<b>üë• –î–õ–Ø –ö–û–ì–û –≠–¢–û–¢ –ö–£–†–°:</b>
‚Ä¢ üöÄ –ù–∞—á–∏–Ω–∞—é—â–∏–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏
‚Ä¢ üíº –í–ª–∞–¥–µ–ª—å—Ü—ã –º–∞–ª–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞
‚Ä¢ üë®‚Äçüíº –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø–æ –∑–∞–∫—É–ø–∫–∞–º
‚Ä¢ üìà –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
‚Ä¢ üéì –í—ã–ø—É—Å–∫–Ω–∏–∫–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –≤—É–∑–æ–≤
‚Ä¢ üîÑ –í—Å–µ, –∫—Ç–æ —Ö–æ—á–µ—Ç –æ—Å–≤–æ–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ—Ñ–µ—Å—Å–∏—é

<b>üí∞ –°–¢–û–ò–ú–û–°–¢–¨:</b>

<s>–û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞: 7 500 —Ä—É–±.</s>

‚ú® <b>–ê–ö–¶–ò–û–ù–ù–ê–Ø –¶–ï–ù–ê: 3 999 —Ä—É–±.</b>
‚è∞ <b>–ê–∫—Ü–∏—è –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞!</b>

<b>üìû –ö–û–ù–¢–ê–ö–¢–´:</b>
–¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['mobile']}
Email: {ADDITIONAL_MATERIALS['contacts']['email']}
–°–∞–π—Ç: {ADDITIONAL_MATERIALS['contacts']['website']}
–¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}

<b>üîì –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞–∂–º–∏—Ç–µ "üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø"</b>
"""
    
    await message.answer(
        about_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard(user_id)
    )

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –° –î–û–°–¢–£–ü–û–ú ===========
@dp.message(F.text == "üìö –ú–µ–Ω—é –∫—É—Ä—Å–∞")
async def handle_course_menu(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –∫—É—Ä—Å–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º —É—Ä–æ–∫–æ–≤
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    lessons_text = f"<b>üìö –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è ({len(MODULES)} –º–æ–¥—É–ª–µ–π):</b>\n\n"
    
    for i, module in enumerate(MODULES, 1):
        audio_icon = "üéß " if module.get("has_audio", False) else ""
        lessons_text += f"{module['emoji']} {audio_icon}<b>–î–µ–Ω—å {module['day']}:</b> {module['title']}\n"
        
        if user_id in user_progress:
            if i in user_progress[user_id].get('completed_modules', []):
                lessons_text += "   ‚úÖ –ü—Ä–æ–π–¥–µ–Ω\n"
            else:
                lessons_text += "   ‚è≥ –ù–µ –ø—Ä–æ–π–¥–µ–Ω\n"
        
        lessons_text += "\n"
    
    await message.answer(
        lessons_text,
        reply_markup=get_lessons_list_keyboard(),
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "üéß –ê—É–¥–∏–æ —É—Ä–æ–∫–∏")
async def handle_audio_lessons(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞—É–¥–∏–æ-—É—Ä–æ–∫–∏
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—É–¥–∏–æ —É—Ä–æ–∫–∞–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    audio_list = f"<b>üéß –í—Å–µ –∞—É–¥–∏–æ-—É—Ä–æ–∫–∏ –∫—É—Ä—Å–∞ ({len(MODULES)} –º–æ–¥—É–ª–µ–π):</b>\n\n"
    
    for i, module in enumerate(MODULES, 1):
        audio_info = AudioManager.get_audio_info(i-1)
        if audio_info.get("exists"):
            duration_min = audio_info['duration'] // 60
            duration_sec = audio_info['duration'] % 60
            audio_list += f"üéß <b>–î–µ–Ω—å {module['day']}:</b> {module['title']}\n"
            audio_list += f"   ‚è± {duration_min}:{duration_sec:02d}\n"
            audio_list += f"   üìù {audio_info['title']}\n\n"
    
    if audio_list == f"<b>üéß –í—Å–µ –∞—É–¥–∏–æ-—É—Ä–æ–∫–∏ –∫—É—Ä—Å–∞ ({len(MODULES)} –º–æ–¥—É–ª–µ–π):</b>\n\n":
        audio_list += "‚ùå –ê—É–¥–∏–æ-—É—Ä–æ–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"
    else:
        audio_list += "<i>–ê—É–¥–∏–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Ä–æ–∫–∞ <b>—Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ</b></i>"
    
    await message.answer(
        audio_list,
        reply_markup=get_main_keyboard(user_id),
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å")
async def handle_my_progress(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    if user_id not in user_progress:
        await message.answer(
            "‚ùå –í—ã –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏ –æ–±—É—á–µ–Ω–∏–µ. –ù–∞–∂–º–∏—Ç–µ /start",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    progress = user_progress[user_id]
    completed = len(progress.get('completed_modules', []))
    total = len(MODULES)
    percentage = (completed / total) * 100 if total > 0 else 0
    
    audio_listened = len(progress.get('audio_listened', []))
    audio_total = sum(1 for module in MODULES if module.get("has_audio", False))
    audio_percentage = (audio_listened / audio_total * 100) if audio_total > 0 else 0
    
    test_results = progress.get('test_results', [])
    last_test = test_results[-1] if test_results else None
    
    admin_badge = " üëë" if access_control.is_admin(user_id) else ""
    
    progress_text = f"""
<b>üìä –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –∫—É—Ä—Å–µ{admin_badge}:</b>

üë§ <b>–ò–º—è:</b> {progress.get('name', '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}
üìÖ <b>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</b> {progress['start_date'][:10]}
üéØ <b>–ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫:</b> {progress.get('last_module', 0) + 1}/{total}

<b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>
‚úÖ <b>–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤:</b> {completed}/{total} ({percentage:.1f}%)
üéß <b>–ü—Ä–æ—Å–ª—É—à–∞–Ω–æ –∞—É–¥–∏–æ:</b> {audio_listened}/{audio_total} ({audio_percentage:.1f}%)
üìù <b>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤:</b> {len(test_results)}
"""
    
    if last_test:
        progress_text += f"üèÜ <b>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç:</b> {last_test['correct_answers']}/{last_test['total_questions']} ({last_test['percentage']:.1f}%)\n"
    
    progress_text += "\n<b>–°—Ç–∞—Ç—É—Å —É—Ä–æ–∫–æ–≤:</b>\n"
    
    for i in range(1, total + 1):
        module = MODULES[i-1]
        if i in progress.get('completed_modules', []):
            audio_icon = "üéß" if i in progress.get('audio_listened', []) else ""
            progress_text += f"‚úÖ {audio_icon} –î–µ–Ω—å {module['day']}: {module['title'][:25]}\n"
        else:
            progress_text += f"‚è≥ –î–µ–Ω—å {module['day']}: {module['title'][:25]}\n"
    
    progress_text += "\n<b>–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –æ–±—É—á–µ–Ω–∏–µ! üí™</b>"
    
    await message.answer(
        progress_text,
        reply_markup=get_main_keyboard(user_id),
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã")
async def handle_contacts(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    """
    user_id = message.from_user.id
    contacts_text = f"""
<b>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏:</b>

üìß <b>Email:</b> {ADDITIONAL_MATERIALS['contacts']['email']}
üì± <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> {ADDITIONAL_MATERIALS['contacts']['phone']}
üì≤ <b>–ú–æ–±–∏–ª—å–Ω—ã–π:</b> {ADDITIONAL_MATERIALS['contacts']['mobile']}
<b>–¢–µ–ª–µ–≥—Ä–∞–º:</b> {ADDITIONAL_MATERIALS['contacts']['telegram']}

üåê <b>–°–∞–π—Ç:</b> {ADDITIONAL_MATERIALS['contacts']['website']}
üìÑ <b>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</b> https://tritika.ru/privacy-policy/

<b>üìÖ –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</b>
–ü–Ω-–ü—Ç: 8:30-17:30 –ø–æ –ú–°–ö
–°–±-–í—Å: –≤—ã—Ö–æ–¥–Ω–æ–π

<b>‚úâÔ∏è –ü–∏—à–∏—Ç–µ –Ω–∞–º –ø–æ –ª—é–±—ã–º –≤–æ–ø—Ä–æ—Å–∞–º:</b>
‚Ä¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–æ—Ç–æ–º
‚Ä¢ –í–æ–ø—Ä–æ—Å—ã –ø–æ –∫—É—Ä—Å—É
‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Ç–µ–Ω–¥–µ—Ä–∞–º
‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É
‚Ä¢ –í–æ–ø—Ä–æ—Å—ã –ø–æ –æ–ø–ª–∞—Ç–µ –∏ –¥–æ—Å—Ç—É–ø—É
    """
    
    await message.answer(
        contacts_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard(user_id)
    )

@dp.message(F.text == "üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏")
async def handle_useful_links(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
    """
    user_id = message.from_user.id
    links_text = "<b>üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã:</b>\n\n"
    
    for name, url in ADDITIONAL_MATERIALS['links'].items():
        links_text += f"‚Ä¢ <a href='{url}'>{name}</a>\n"
    
    links_text += "\n<b>üì± –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</b>\n"
    links_text += f"üìß Email: {ADDITIONAL_MATERIALS['contacts']['email']}\n"
    links_text += f"üìû –¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['phone']}\n"
    links_text += f"üì≤ –ú–æ–±–∏–ª—å–Ω—ã–π: {ADDITIONAL_MATERIALS['contacts']['mobile']}\n"
    links_text += f"üåê –°–∞–π—Ç: {ADDITIONAL_MATERIALS['contacts']['website']}\n"
    links_text += f"üì¢ –¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}"
    
    await message.answer(
        links_text,
        parse_mode=ParseMode.HTML,
        disable_web_page_preview=True,
        reply_markup=get_main_keyboard(user_id)
    )

@dp.message(F.text == "üÜò –ü–æ–º–æ—â—å")
async def handle_help(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É
    """
    user_id = message.from_user.id
    help_text = f"""
<b>üÜò –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞:</b>

<b>üéß –ê—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ:</b>
‚Ä¢ –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Ä–æ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—É–¥–∏–æ-–ø–æ—è—Å–Ω–µ–Ω–∏–µ <b>—Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –º–æ–¥—É–ª—è –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ</b>
‚Ä¢ –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ "üéß –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ"
‚Ä¢ –í—Å–µ –∞—É–¥–∏–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MP3, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –ª—é–±—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

<b>üìö –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É:</b>
‚Ä¢ <b>üìö –ú–µ–Ω—é –∫—É—Ä—Å–∞</b> - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö {len(MODULES)} —É—Ä–æ–∫–æ–≤
‚Ä¢ –í —É—Ä–æ–∫–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ "‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫" –∏ "–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ ‚û°Ô∏è"
‚Ä¢ <b>‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º –≤ –∞—É–¥–∏–æ-—Å–æ–æ–±—â–µ–Ω–∏–∏</b> - –æ—Ç–º–µ—á–∞–π—Ç–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏ –ø—Ä—è–º–æ –≤ –∞—É–¥–∏–æ
‚Ä¢ "üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é" - –≤–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–Ω–æ–ø–∫–∞–º

<b>üìù –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç:</b>
‚Ä¢ <b>üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</b> - –∑–∞–ø—É—Å–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (8 –≤–æ–ø—Ä–æ—Å–æ–≤)
‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ (–∞, –±, –≤, –≥)
‚Ä¢ –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å ("‚è≠ –ü—Ä–æ–ø—É—á–∏—Ç—å")
‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∞—à–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–µ

<b>üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞:</b>
‚Ä¢ <b>üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç</b> - —Å–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Word
‚Ä¢ –ß–µ–∫-–ª–∏—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç 10 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —à–∞–≥–æ–≤ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏

<b>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</b>
‚Ä¢ <b>‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏</b> - –±—ã—Å—Ç—Ä–æ –æ—Ç–º–µ—á–∞–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ

<b>üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:</b>
‚Ä¢ –í "üìä –ú–æ–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–µ" –≤–∏–¥–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º —É—Ä–æ–∫–∞–º –∏ –ø—Ä–æ—Å–ª—É—à–∞–Ω–Ω—ã–º –∞—É–¥–∏–æ
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—É—Ä—Å–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚Ä¢ <b>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</b> - –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

<b>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</b>
‚Ä¢ –ï—Å–ª–∏ –∞—É–¥–∏–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üéß –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ"
‚Ä¢ –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–æ—Ç–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π /start
‚Ä¢ –î–ª—è —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É

<b>üí∞ –û–ø–ª–∞—Ç–∞ –∏ –¥–æ—Å—Ç—É–ø:</b>
‚Ä¢ <b>üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø</b> - –æ–ø–ª–∞—Ç–∞ –∫—É—Ä—Å–∞ (3 999 —Ä—É–±. –ø–æ –∞–∫—Ü–∏–∏ –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026)
‚Ä¢ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫ –≤ —á–∞—Ç
‚Ä¢ –î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤

<b>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</b>
‚Ä¢ Email: {ADDITIONAL_MATERIALS['contacts']['email']}
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['phone']}
‚Ä¢ –°–∞–π—Ç: {ADDITIONAL_MATERIALS['contacts']['website']}
‚Ä¢ –¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}

<b>üïí –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</b>
–ü–Ω-–ü—Ç: 8:30-17:30 –ø–æ –ú–°–ö
    """
    
    await message.answer(
        help_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard(user_id)
    )

# =========== –¢–ï–°–¢ ===========
@dp.message(F.text == "üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç")
async def handle_start_test(message: Message, state: FSMContext):
    """
    –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ–π–¥–µ–Ω—ã –ª–∏ –ø–µ—Ä–≤—ã–µ 7 –º–æ–¥—É–ª–µ–π (–æ—Å–Ω–æ–≤–Ω—ã–µ)
    if user_id in user_progress:
        completed = len(user_progress[user_id].get('completed_modules', []))
        total = len(MODULES)
        
        if completed < 7:
            keyboard = ReplyKeyboardMarkup(
                keyboard=[
                    [
                        KeyboardButton(text="‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏"),
                        KeyboardButton(text="üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ")
                    ],
                    [
                        KeyboardButton(text="üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–±—É—á–µ–Ω–∏—é"),
                        KeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å")
                    ]
                ],
                resize_keyboard=True
            )
            
            await message.answer(
                f"‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ!</b>\n\n"
                f"–í—ã –ø—Ä–æ—à–ª–∏ {completed} –∏–∑ {total} –º–æ–¥—É–ª–µ–π.\n\n"
                f"<b>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–≤—ã–µ 7 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º.</b>\n\n"
                f"<b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>\n"
                f"1Ô∏è‚É£ <b>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</b> - –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏\n"
                f"2Ô∏è‚É£ <b>–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏</b> - –µ—Å–ª–∏ –≤—ã —É–∂–µ –∏–∑—É—á–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª\n"
                f"3Ô∏è‚É£ <b>–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ</b> - –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å–µ–π—á–∞—Å\n\n"
                f"<i>–î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–≤—ã–µ 7 –º–æ–¥—É–ª–µ–π.</i>",
                reply_markup=keyboard,
                parse_mode=ParseMode.HTML
            )
            return
    
    await start_test_confirm(message)

async def start_test_confirm(message: Message):
    """
    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞
    """
    user_id = message.from_user.id
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="‚úÖ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç"),
                KeyboardButton(text="üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç")
            ],
            [
                KeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞"),
                KeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å")
            ]
        ],
        resize_keyboard=True
    )
    
    test_info = f"""
<b>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ:</b>

üî¢ <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤:</b> {len(TEST_QUESTIONS)}
‚è± <b>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è:</b> 10-15 –º–∏–Ω—É—Ç
üìä <b>–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª:</b> 5 –∏–∑ 8 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
üîÑ <b>–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:</b> –î–∞, –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ

<b>üìã –§–æ—Ä–º–∞—Ç —Ç–µ—Å—Ç–∞:</b>
‚Ä¢ –ö–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –∏–º–µ–µ—Ç 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (–∞, –±, –≤, –≥)
‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
‚Ä¢ –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã
‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

<b>üéØ –°–æ–≤–µ—Ç—ã:</b>
‚Ä¢ –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã
‚Ä¢ –ò—Å–∫–ª—é—á–∞–π—Ç–µ –∑–∞–≤–µ–¥–æ–º–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
‚Ä¢ –ù–µ —Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å —Å –æ—Ç–≤–µ—Ç–∞–º–∏
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–Ω–∞–Ω–∏—è –∏–∑ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

<b>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç?</b>
"""
    
    await message.answer(
        test_info,
        reply_markup=keyboard,
        parse_mode=ParseMode.HTML
    )

@dp.message(F.text == "‚úÖ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç")
async def handle_confirm_start_test(message: Message, state: FSMContext):
    """
    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞ - –ü–†–Ø–ú–û–ô –ó–ê–ü–£–°–ö
    """
    await start_test_internal(message, state)

@dp.message(F.text == "üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ")
async def handle_force_start_test(message: Message, state: FSMContext):
    """
    –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥—É–ª–µ–π
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await message.answer(
        "‚ö†Ô∏è <b>–í—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ —Ç–µ—Å—Ç, –Ω–µ –∑–∞–≤–µ—Ä—à–∏–≤ –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏.</b>\n\n"
        "<i>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–∑—É—á–µ–Ω–∏—é –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞.</i>",
        parse_mode=ParseMode.HTML
    )
    await start_test_confirm(message)

@dp.message(F.text == "‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏")
async def handle_mark_all_modules(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏" –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    if user_id not in user_progress:
        user_progress[user_id] = {
            'start_date': datetime.now().isoformat(),
            'completed_modules': [],
            'last_module': 0,
            'name': message.from_user.first_name,
            'audio_listened': [],
            'test_results': []
        }
    
    user_progress[user_id]['completed_modules'] = list(range(1, len(MODULES) + 1))
    
    for i in range(1, len(MODULES) + 1):
        if i not in user_progress[user_id].get('audio_listened', []):
            user_progress[user_id].setdefault('audio_listened', []).append(i)
    
    save_user_progress()
    
    test_results = user_progress[user_id].get('test_results', [])
    
    if not test_results:
        await message.answer(
            f"‚úÖ –í—Å–µ {len(MODULES)} –º–æ–¥—É–ª–µ–π –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ!\n\n"
            "üéâ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç.\n"
            "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.",
            reply_markup=get_main_keyboard(user_id),
            parse_mode=ParseMode.HTML
        )
    else:
        await message.answer(
            f"‚úÖ –í—Å–µ {len(MODULES)} –º–æ–¥—É–ª–µ–π –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ!\n\n"
            "üéâ –í—ã —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ç–µ—Å—Ç. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.\n"
            "üéÅ –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–∞—Ä–∫–∞–º–∏ –≤ 8 –¥–Ω–µ –∫—É—Ä—Å–∞!",
            reply_markup=get_main_keyboard(user_id),
            parse_mode=ParseMode.HTML
        )

@dp.message(F.text == "üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞")
async def handle_test_results(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–∞. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    if user_id not in user_progress:
        await message.answer(
            "‚ùå –í—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ù–∞—á–Ω–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ —Å /start",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    test_results = user_progress[user_id].get('test_results', [])
    
    if not test_results:
        await message.answer(
            "üìù <b>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</b>\n\n"
            "–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –º–æ–∂–Ω–æ –ø–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –∫—É—Ä—Å–∞.\n"
            "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –¥–ª—è –Ω–∞—á–∞–ª–∞.",
            reply_markup=get_main_keyboard(user_id),
            parse_mode=ParseMode.HTML
        )
        return
    
    last_test = test_results[-1]
    
    result_text = f"""
<b>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ—Å—Ç–∞:</b>

üìÖ <b>–î–∞—Ç–∞:</b> {datetime.fromisoformat(last_test['date']).strftime('%d.%m.%Y %H:%M')}
‚úÖ <b>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</b> {last_test['correct_answers']} –∏–∑ {last_test['total_questions']}
üìä <b>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</b> {last_test['percentage']:.1f}%
‚≠ê <b>–û—Ü–µ–Ω–∫–∞:</b> {last_test['correct_answers']}/{last_test['total_questions']}

<b>üìã –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b>
"""
    
    for i, result in enumerate(last_test['results'], 1):
        status = "‚úÖ" if result["is_correct"] else "‚ùå"
        result_text += f"\n{status} <b>–í–æ–ø—Ä–æ—Å {i}:</b>"
        result_text += f"\n–í–∞—à –æ—Ç–≤–µ—Ç: <b>{result['user_answer'] if result['user_answer'] else '–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞'}</b>"
        result_text += f"\n–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π: <b>{result['correct_text']}</b>\n"
    
    if len(test_results) > 1:
        result_text += f"\n<b>üìä –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤:</b> {len(test_results)} –ø–æ–ø—ã—Ç–æ–∫"
        for i, test in enumerate(test_results[-5:], 1):
            date_str = datetime.fromisoformat(test['date']).strftime('%d.%m')
            result_text += f"\n{i}. {date_str}: {test['correct_answers']}/{test['total_questions']} ({test['percentage']:.1f}%)"
    
    result_text += "\n\n<b>üéØ –°–æ–≤–µ—Ç:</b> –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –º–æ–¥—É–ª–∏ —Å –æ—à–∏–±–∫–∞–º–∏."
    
    if last_test['correct_answers'] >= 5:
        result_text += "\n\nüéâ <b>–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú –° –£–°–ü–ï–®–ù–´–ú –ü–†–û–•–û–ñ–î–ï–ù–ò–ï–ú –ö–£–†–°–ê –ò –¢–ï–°–¢–ê!</b> üéâ"
        result_text += "\n\n‚úÖ –í—ã –æ—Å–≤–æ–∏–ª–∏ –æ—Å–Ω–æ–≤—ã —Ç–µ–Ω–¥–µ—Ä–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã"
        result_text += "\n‚úÖ –í—ã –≥–æ—Ç–æ–≤—ã –∫ –ø–µ—Ä–≤—ã–º —à–∞–≥–∞–º –≤ –º–∏—Ä–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤"
        result_text += "\n‚úÖ –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π"
        result_text += "\n‚úÖ –í—ã –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –∏—Å–∫–∞—Ç—å –∑–∞–∫—É–ø–∫–∏ –∏ –∫–∞–∫ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
        result_text += "\nüéÅ <b>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–∞—Ä–∫–∞–º–∏ –≤ 8 –¥–Ω–µ –∫—É—Ä—Å–∞!</b>"
        result_text += "\n\n<b>–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å! –ü–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π!</b>"
    
    await message.answer(
        result_text,
        reply_markup=get_main_keyboard(user_id),
        parse_mode=ParseMode.HTML
    )

# =========== –û–¢–í–ï–¢–´ –ù–ê –¢–ï–°–¢ ===========
@dp.message(F.text.in_({"–∞", "–±", "–≤", "–≥"}), UserState.taking_test)
async def handle_test_answer(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞
    """
    await process_test_answer(message, state, message.text)

@dp.message(F.text == "‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", UserState.taking_test)
async def handle_skip_question(message: Message, state: FSMContext):
    """
    –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    test_data = data.get("test_data", {})
    current_question = test_data.get("current_question", 0)
    
    next_question = current_question + 1
    
    if next_question < len(TEST_QUESTIONS):
        await message.answer(
            f"‚è≠ –í–æ–ø—Ä–æ—Å {current_question + 1} –ø—Ä–æ–ø—É—â–µ–Ω.",
            parse_mode=ParseMode.HTML
        )
        await send_test_question(message, state, next_question)
    else:
        await finish_test(message, state)

@dp.message(F.text == "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç", UserState.taking_test)
async def handle_finish_test_early(message: Message, state: FSMContext):
    """
    –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ—Å—Ç –¥–æ—Å—Ä–æ—á–Ω–æ
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    await message.answer(
        "üìù <b>–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω –¥–æ—Å—Ä–æ—á–Ω–æ.</b>\n\n"
        "–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.",
        parse_mode=ParseMode.HTML
    )
    await finish_test(message, state)

@dp.message(F.text == "‚ùå –û—Ç–º–µ–Ω–∞")
async def handle_cancel_test(message: Message):
    """
    –û—Ç–º–µ–Ω–∞ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞
    """
    user_id = message.from_user.id
    await message.answer(
        "‚ùå –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ.",
        reply_markup=get_main_keyboard(user_id)
    )

@dp.message(F.text == "üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–±—É—á–µ–Ω–∏—é")
async def handle_back_to_learning(message: Message):
    """
    –í–æ–∑–≤—Ä–∞—Ç –∫ –æ–±—É—á–µ–Ω–∏—é
    """
    user_id = message.from_user.id
    await message.answer(
        "<b>üìö –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –æ–±—É—á–µ–Ω–∏—é...</b>",
        reply_markup=get_main_keyboard(user_id),
        parse_mode=ParseMode.HTML
    )

# =========== –°–ö–ê–ß–ò–í–ê–ù–ò–ï –ß–ï–ö-–õ–ò–°–¢–ê ===========
@dp.message(F.text == "üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç")
async def handle_download_checklist(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç"
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á–µ–∫-–ª–∏—Å—Ç—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    try:
        checklist_path = "–ß–µ–∫-–ª–∏—Å—Ç -–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö-.docx"
        
        if not os.path.exists(checklist_path):
            await message.answer(
                "‚ùå –§–∞–π–ª —á–µ–∫-–ª–∏—Å—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.\n\n"
                "–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é —á–µ–∫-–ª–∏—Å—Ç–∞ –∏–∑ 7 –º–æ–¥—É–ª—è –∫—É—Ä—Å–∞.",
                parse_mode=ParseMode.HTML
            )
            return
        
        document = FSInputFile(checklist_path)
        
        admin_badge = " (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)" if access_control.is_admin(user_id) else ""
        
        caption = f"""‚úÖ <b>–ß–µ–∫-–ª–∏—Å—Ç "–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö"{admin_badge}</b>

üìã <b>–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:</b>
‚Ä¢ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏
‚Ä¢ 10 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —à–∞–≥–æ–≤ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ –¥–æ –ø–µ—Ä–≤–æ–π –∑–∞—è–≤–∫–∏
‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Å—Å—ã–ª–∫–∏
‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

üí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
2. –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∏–ª–∏ –¥–µ—Ä–∂–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ
3. –û—Ç–º–µ—á–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏
4. –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å!

<b>–£ –≤–∞—Å –≤—Å–µ –ø–æ–ª—É—á–∏—Ç—Å—è! –≠—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç ‚Äî –≤–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–∏—Ä–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤.</b>"""
        
        await message.answer_document(
            document=document,
            caption=caption,
            parse_mode=ParseMode.HTML
        )
        
        logger.info(f"Checklist sent to user {message.from_user.id}")
        
    except Exception as e:
        logger.error(f"Error sending checklist: {e}")
        await message.answer(
            "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞.\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∏–∑ 7 –º–æ–¥—É–ª—è.",
            parse_mode=ParseMode.HTML
        )

# =========== –í–´–ë–û–† –£–†–û–ö–ê ===========
@dp.message(F.text.startswith(("üìö", "üèõÔ∏è", "üè¢", "üíº", "üè¶", "üöÄ", "üèÜ", "üéÅ")))
async def handle_lesson_selection(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Ä–æ–∫–∞–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    try:
        for i, module in enumerate(MODULES):
            audio_icon = "üéß " if module.get("has_audio", False) else ""
            button_text = f"{module['emoji']} {audio_icon}–î–µ–Ω—å {module['day']}: {module['title'][:20]}"
            
            if message.text.startswith(module['emoji']) or button_text in message.text:
                await show_module(message, i, state)
                return
        
        await message.answer(
            "‚ùå –£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω. –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞.",
            reply_markup=get_lessons_list_keyboard()
        )
    except Exception as e:
        logger.error(f"Lesson selection error: {e}")
        await message.answer(
            "‚ùå –û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
            reply_markup=get_main_keyboard(user_id)
        )

# =========== –ù–ê–í–ò–ì–ê–¶–ò–Ø –í –£–†–û–ö–ï ===========
@dp.message(F.text == "‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫")
async def handle_prev_lesson(message: Message, state: FSMContext):
    """
    –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —É—Ä–æ–∫—É
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Ä–æ–∫–∞–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    current_module = data.get("current_module", 0)
    
    if current_module > 0:
        await show_module(message, current_module - 1, state)
    else:
        await message.answer(
            "‚ùå –≠—Ç–æ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫. –ü—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —É—Ä–æ–∫–∞ –Ω–µ—Ç.",
            reply_markup=get_lesson_navigation_keyboard(current_module, len(MODULES))
        )

@dp.message(F.text == "–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ ‚û°Ô∏è")
async def handle_next_lesson(message: Message, state: FSMContext):
    """
    –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Ä–æ–∫–∞–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    current_module = data.get("current_module", 0)
    
    if current_module < len(MODULES) - 1:
        await show_module(message, current_module + 1, state)
    else:
        # –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫ (8 –¥–µ–Ω—å)
        await message.answer(
            "üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –∫—É—Ä—Å–∞!</b>\n\n"
            "–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —É—Ä–æ–∫–∏ –∏ –ø–æ–ª—É—á–∏–ª–∏ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∑–Ω–∞–Ω–∏–π –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö.\n\n"
            "üìù <b>–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!</b>\n"
            "üéÅ <b>–ê –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ—à–ª–∏, —Ç–æ –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –ø–æ–¥–∞—Ä–∫–∏ –≤ 8 –¥–Ω–µ!</b>",
            reply_markup=get_lesson_navigation_keyboard(current_module, len(MODULES)),
            parse_mode=ParseMode.HTML
        )

@dp.message(F.text == "üéß –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∞—É–¥–∏–æ")
async def handle_listen_audio(message: Message, state: FSMContext):
    """
    –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –∫ —Ç–µ–∫—É—â–µ–º—É —É—Ä–æ–∫—É
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—É–¥–∏–æ —É—Ä–æ–∫–∞–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    current_module = data.get("current_module", 0)
    
    if current_module is not None:
        audio_sent = await audio_manager.send_module_audio(message.chat.id, current_module, user_id)
        
        if audio_sent:
            if user_id in user_progress:
                if current_module + 1 not in user_progress[user_id].get('audio_listened', []):
                    user_progress[user_id].setdefault('audio_listened', []).append(current_module + 1)
                    save_user_progress()
            
            await message.answer(
                "üéß –ê—É–¥–∏–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!",
                reply_markup=get_lesson_navigation_keyboard(current_module, len(MODULES))
            )
        else:
            await message.answer(
                "‚ùå –ê—É–¥–∏–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                reply_markup=get_lesson_navigation_keyboard(current_module, len(MODULES))
            )
    else:
        await message.answer(
            "‚ùå –í—ã –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —É—Ä–æ–∫–µ. –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –∏–∑ –º–µ–Ω—é.",
            reply_markup=get_main_keyboard(user_id)
        )

@dp.message(F.text == "‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º")
async def handle_complete_lesson(message: Message, state: FSMContext):
    """
    –û—Ç–º–µ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞ –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ (—á–µ—Ä–µ–∑ reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É)
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—É—Ä—Å—É. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    data = await state.get_data()
    current_module = data.get("current_module", 0)
    
    if current_module is not None:
        if user_id not in user_progress:
            user_progress[user_id] = {
                'start_date': datetime.now().isoformat(),
                'completed_modules': [],
                'last_module': current_module,
                'name': message.from_user.first_name,
                'audio_listened': [],
                'test_results': []
            }
        
        module_num = current_module + 1
        if module_num not in user_progress[user_id]['completed_modules']:
            user_progress[user_id]['completed_modules'].append(module_num)
            save_user_progress()
            
            await message.answer(
                f"‚úÖ –£—Ä–æ–∫ {module_num} –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π!\n\n"
                "<i>–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –∞—É–¥–∏–æ-—Å–æ–æ–±—â–µ–Ω–∏–∏ –≤—ã—à–µ.</i>",
                reply_markup=get_lesson_navigation_keyboard(current_module, len(MODULES)),
                parse_mode=ParseMode.HTML
            )
            
            completed = len(user_progress[user_id]['completed_modules'])
            total = len(MODULES)
            
            if completed >= 7 and not user_progress[user_id].get('test_results'):
                await message.answer(
                    "üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞!</b>\n\n"
                    "üìù <b>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç:</b>\n"
                    "1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è\n"
                    "2. –ü–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É\n"
                    "3. –£–≤–∏–¥–µ—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é\n\n"
                    "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!",
                    reply_markup=get_main_keyboard(user_id),
                    parse_mode=ParseMode.HTML
                )
            elif completed == total:
                await message.answer(
                    "üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å–µ –º–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞, –≤–∫–ª—é—á–∞—è –±–æ–Ω—É—Å–Ω—ã–π!</b>\n\n"
                    "üìù <b>–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!</b>\n"
                    "üéÅ <b>–ê –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ—à–ª–∏, —Ç–æ –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –ø–æ–¥–∞—Ä–∫–∏ –≤ 8 –¥–Ω–µ!</b>",
                    reply_markup=get_main_keyboard(user_id),
                    parse_mode=ParseMode.HTML
                )
        else:
            await message.answer(
                "‚ÑπÔ∏è –≠—Ç–æ—Ç —É—Ä–æ–∫ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π",
                reply_markup=get_lesson_navigation_keyboard(current_module, len(MODULES))
            )
    else:
        await message.answer(
            "‚ùå –í—ã –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —É—Ä–æ–∫–µ. –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –∏–∑ –º–µ–Ω—é.",
            reply_markup=get_main_keyboard(user_id)
        )

# =========== –í–û–ó–í–†–ê–¢ –í –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ===========
@dp.message(F.text.in_({"üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "üîô –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É", "üîô –ù–∞–∑–∞–¥"}))
async def handle_back_to_main(message: Message, state: FSMContext):
    """
    –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    """
    user_id = message.from_user.id
    await state.clear()
    
    if access_control.is_admin(user_id):
        await message.answer(
            "<b>üëë –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n"
            "–í—ã –∏–º–µ–µ—Ç–µ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.",
            reply_markup=get_main_keyboard(user_id),
            parse_mode=ParseMode.HTML
        )
    elif access_control.is_paid_user(user_id):
        await cmd_start(message, state)
    else:
        await cmd_start(message, state)

# =========== –ö–û–ú–ê–ù–î–´ –û–¢–õ–ê–î–ö–ò ===========
@dp.message(Command("checkadmins"))
async def cmd_checkadmins(message: Message):
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    """
    user_id = message.from_user.id
    admins = access_control.get_all_admins()
    
    check_text = f"""
<b>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</b>

<b>–í–∞—à ID:</b> <code>{user_id}</code>
<b>–í—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</b> {'‚úÖ –î–∞' if access_control.is_admin(user_id) else '‚ùå –ù–µ—Ç'}
<b>–í—ã –∏–º–µ–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É:</b> {'‚úÖ –î–∞' if access_control.is_paid_user(user_id) else '‚ùå –ù–µ—Ç'}

<b>–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</b>
"""
    
    if admins:
        for i, admin_id in enumerate(admins, 1):
            check_text += f"{i}. <code>{admin_id}</code>\n"
    else:
        check_text += "‚ùå –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø—É—Å—Ç\n"
    
    check_text += f"\n<b>–í—Å–µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</b> {len(admins)}"
    
    initial_admins_env = os.getenv('INITIAL_ADMINS', '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞')
    check_text += f"\n<b>INITIAL_ADMINS –∏–∑ .env:</b> {initial_admins_env}"
    
    await message.answer(
        check_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard(user_id)
    )

@dp.message(Command("debug"))
async def cmd_debug(message: Message):
    """
    –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    """
    user_id = message.from_user.id
    
    debug_text = f"""
<b>üõ† –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</b>

<b>–°–∏—Å—Ç–µ–º–∞:</b>
‚Ä¢ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <code>{user_id}</code>
‚Ä¢ –í—Ä–µ–º—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤: {restart_count}

<b>–î–æ—Å—Ç—É–ø:</b>
‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: {access_control.is_admin(user_id)}
‚Ä¢ –û–ø–ª–∞—Ç–∏–≤—à–∏–π/–∏–º–µ—é—â–∏–π –¥–æ—Å—Ç—É–ø: {access_control.is_paid_user(user_id)}

<b>–ö—É—Ä—Å:</b>
‚Ä¢ –í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π: {len(MODULES)}
‚Ä¢ –ò–∑ –Ω–∏—Ö —Å –∞—É–¥–∏–æ: {sum(1 for m in MODULES if m.get('has_audio'))}
‚Ä¢ –í–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ—Å—Ç–µ: {len(TEST_QUESTIONS)}

<b>–ü—Ä–æ–≥—Ä–µ—Å—Å:</b>
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: {len(user_progress)}
‚Ä¢ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å: {len(user_progress.get(user_id, {}).get('completed_modules', []))}/{len(MODULES)} –º–æ–¥—É–ª–µ–π

<b>–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:</b>
‚Ä¢ BOT_TOKEN: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if BOT_TOKEN else '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}
‚Ä¢ INITIAL_ADMINS: {os.getenv('INITIAL_ADMINS', '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞')}
‚Ä¢ PORT: {PORT}
"""
    
    await message.answer(
        debug_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard(user_id)
    )

# =========== –î–†–£–ì–ò–ï –ö–û–ú–ê–ù–î–´ ===========
@dp.message(Command("menu"))
async def cmd_menu(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /menu
    """
    user_id = message.from_user.id
    await message.answer(
        "<b>üìã –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:</b>\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.",
        reply_markup=get_main_keyboard(user_id),
        parse_mode=ParseMode.HTML
    )

@dp.message(Command("help"))
async def cmd_help(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
    """
    await handle_help(message)

@dp.message(Command("progress"))
async def cmd_progress(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /progress
    """
    await handle_my_progress(message)

@dp.message(Command("audio"))
async def cmd_audio(message: Message, command: CommandObject):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /audio [–Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞]
    """
    user_id = message.from_user.id
    
    if not access_control.is_paid_user(user_id):
        await message.answer(
            "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—É–¥–∏–æ —É—Ä–æ–∫–∞–º. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.",
            reply_markup=get_main_keyboard(user_id)
        )
        return
    
    try:
        if not command.args:
            await handle_audio_lessons(message)
            return
        
        module_num = int(command.args)
        if 1 <= module_num <= len(MODULES):
            module_index = module_num - 1
            audio_sent = await audio_manager.send_module_audio(message.chat.id, module_index, user_id)
            
            if audio_sent:
                if module_num not in user_progress[user_id].get('audio_listened', []):
                    user_progress[user_id].setdefault('audio_listened', []).append(module_num)
                    save_user_progress()
                
                await message.answer(
                    f"üéß –ê—É–¥–∏–æ –∫ —É—Ä–æ–∫—É {module_num} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!",
                    reply_markup=get_main_keyboard(user_id)
                )
            else:
                await message.answer(
                    "‚ùå –ê—É–¥–∏–æ –¥–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
                    reply_markup=get_main_keyboard(user_id)
                )
        else:
            await message.answer(
                f"‚ùå –£—Ä–æ–∫ {module_num} –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–∫–∏: 1-{len(MODULES)}",
                reply_markup=get_main_keyboard(user_id)
            )
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /audio 1",
            reply_markup=get_main_keyboard(user_id)
        )

@dp.message(Command("test"))
async def cmd_test(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /test
    """
    await handle_start_test(message, state)

@dp.message(Command("status"))
async def cmd_status(message: Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
    """
    user_id = message.from_user.id
    status_text = f"""
<b>üìä –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞:</b>

üïí <b>–í—Ä–µ–º—è:</b> {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
üë• <b>–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</b> {len(user_progress)}
üîÑ <b>–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤:</b> {restart_count}/{max_restarts}
üìö <b>–ú–æ–¥—É–ª–µ–π –≤ –∫—É—Ä—Å–µ:</b> {len(MODULES)}
üéß <b>–ê—É–¥–∏–æ —É—Ä–æ–∫–æ–≤:</b> {sum(1 for m in MODULES if m.get('has_audio'))}
üìù <b>–í–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ—Å—Ç–µ:</b> {len(TEST_QUESTIONS)}
üì• <b>–ß–µ–∫-–ª–∏—Å—Ç:</b> {"–î–æ—Å—Ç—É–ø–µ–Ω" if os.path.exists("–ß–µ–∫-–ª–∏—Å—Ç -–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö-.docx") else "–ù–µ –Ω–∞–π–¥–µ–Ω"}
üì± <b>QR-–∫–æ–¥ –æ–ø–ª–∞—Ç—ã:</b> {"–î–æ—Å—Ç—É–ø–µ–Ω" if os.path.exists("qr_code.png") else "–ù–µ –Ω–∞–π–¥–µ–Ω"}

<b>–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞:</b>
‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(access_control.get_all_admins())}
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º: {len(access_control.get_all_paid_users())}

<b>üí∞ –¶–µ–Ω–∞ –∫—É—Ä—Å–∞:</b>
‚Ä¢ –ê–∫—Ü–∏–æ–Ω–Ω–∞—è (–¥–æ 01.2026): 3 999 —Ä—É–±.
‚Ä¢ –ü–æ—Å–ª–µ –∞–∫—Ü–∏–∏: 4 999 —Ä—É–±.

<b>‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ</b>
"""
    
    await message.answer(
        status_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard(user_id)
    )

# =========== –ö–û–ú–ê–ù–î–ê –û–¢–ú–ï–ù–´ ===========
@dp.message(Command("cancel"))
async def cmd_cancel(message: Message, state: FSMContext):
    """
    –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    """
    user_id = message.from_user.id
    current_state = await state.get_state()
    
    if current_state:
        await state.clear()
        
        if access_control.is_admin(user_id):
            await message.answer(
                "‚ùå –î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.",
                reply_markup=get_admin_keyboard()
            )
        elif access_control.is_paid_user(user_id):
            await message.answer(
                "‚ùå –î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.",
                reply_markup=get_main_keyboard(user_id)
            )
        else:
            await message.answer(
                "‚ùå –î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.",
                reply_markup=get_main_keyboard(user_id)
            )
    else:
        if access_control.is_admin(user_id):
            await message.answer(
                "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç–º–µ–Ω—ã.",
                reply_markup=get_admin_keyboard()
            )
        else:
            await message.answer(
                "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç–º–µ–Ω—ã.",
                reply_markup=get_main_keyboard(user_id)
            )

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö –í–°–ï–• –û–°–¢–ê–õ–¨–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô ===========
@dp.message()
async def handle_other_messages(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö –ø—Ä–æ—á–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    """
    user_id = message.from_user.id
    
    data = await state.get_data()
    if data.get('broadcast'):
        if access_control.is_admin(user_id):
            paid_users = access_control.get_all_paid_users()
            
            if not paid_users:
                await message.answer(
                    "‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏.",
                    reply_markup=get_admin_keyboard()
                )
                await state.clear()
                return
            
            await message.answer(
                f"üì¢ <b>–ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—Å—ã–ª–∫—É –¥–ª—è {len(paid_users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</b>",
                parse_mode=ParseMode.HTML
            )
            
            success_count = 0
            fail_count = 0
            
            for target_id in paid_users:
                try:
                    await bot.copy_message(
                        chat_id=target_id,
                        from_chat_id=message.chat.id,
                        message_id=message.message_id,
                        parse_mode=ParseMode.HTML
                    )
                    success_count += 1
                except Exception as e:
                    logger.error(f"Failed to send broadcast to {target_id}: {e}")
                    fail_count += 1
            
            await message.answer(
                f"‚úÖ <b>–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</b>\n\n"
                f"‚Ä¢ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {success_count}\n"
                f"‚Ä¢ –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: {fail_count}\n"
                f"‚Ä¢ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(paid_users)}",
                parse_mode=ParseMode.HTML,
                reply_markup=get_admin_keyboard()
            )
        
        await state.clear()
        return
    
    if message.content_type == ContentType.TEXT:
        if access_control.is_paid_user(user_id):
            await message.answer(
                f"ü§ñ –Ø –±–æ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —Ç–µ–Ω–¥–µ—Ä–∞–º —Å –∞—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ–º ({len(MODULES)} –º–æ–¥—É–ª–µ–π)!\n\n"
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã:\n"
                "/start - –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ\n"
                "/menu - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
                "/help - –ü–æ–º–æ—â—å\n"
                "/progress - –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å\n"
                "/audio - –ê—É–¥–∏–æ —É—Ä–æ–∫–∏\n"
                "/test - –ü—Ä–æ–π—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç\n"
                "/status - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞\n\n"
                "üéß <b>–í–∞–∂–Ω–æ:</b> –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Ä–æ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—É–¥–∏–æ-–ø–æ—è—Å–Ω–µ–Ω–∏–µ <b>—Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ!</b>\n"
                "üìù <b>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—É—Ä—Å–∞ –ø—Ä–æ–π–¥–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç!</b>\n"
                "üì• <b>–°–∫–∞—á–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã!</b>\n"
                "üéÅ <b>–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –≤–∞—Å –∂–¥—É—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤!</b>",
                parse_mode=ParseMode.HTML,
                reply_markup=get_main_keyboard(user_id)
            )
        else:
            await message.answer(
                f"""üîí <b>–£ –í–ê–° –ù–ï–¢ –î–û–°–¢–£–ü–ê –ö –ü–û–õ–ù–û–ú–£ –§–£–ù–ö–¶–ò–û–ù–ê–õ–£ –ë–û–¢–ê</b>

‚ú® <b>üéÅ –ê–ö–¶–ò–Ø! 3 999 —Ä—É–±. –≤–º–µ—Å—Ç–æ 5 000 —Ä—É–±.</b>
‚è∞ <b>* –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞!</b>

<b>üìã –ß–¢–û –í–•–û–î–ò–¢ –í –ö–£–†–° ({len(MODULES)} –º–æ–¥—É–ª–µ–π):</b>
‚Ä¢ {len(MODULES)} –º–æ–¥—É–ª–µ–π —Å –∞—É–¥–∏–æ-—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ–º
‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞
‚Ä¢ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π
‚Ä¢ –ì–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç
‚Ä¢ –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤

<b>üéß –£–ù–ò–ö–ê–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø:</b>
–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Ä–æ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—É–¥–∏–æ-–ø–æ—è—Å–Ω–µ–Ω–∏–µ <b>—Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –º–æ–¥—É–ª—è –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ</b>

<b>üì± –ö–ê–ö –ü–û–õ–£–ß–ò–¢–¨ –î–û–°–¢–£–ü:</b>
1. –í–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ –Ω–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>"üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø"</b>
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–ø–ª–∞—Ç–µ
3. –û–ø–ª–∞—Ç–∏—Ç–µ –∫—É—Ä—Å
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ –Ω–∞ –ø–æ—á—Ç—É info@tritika.ru
5. –ú—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∞—à –¥–æ—Å—Ç—É–ø –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤

<b>üìû –ö–û–ù–¢–ê–ö–¢–´:</b>
–¢–µ–ª–µ—Ñ–æ–Ω: {ADDITIONAL_MATERIALS['contacts']['mobile']}
Email: {ADDITIONAL_MATERIALS['contacts']['email']}
–°–∞–π—Ç: {ADDITIONAL_MATERIALS['contacts']['website']}
–¢–µ–ª–µ–≥—Ä–∞–º: {ADDITIONAL_MATERIALS['contacts']['telegram']}

<b>üÜî –í–∞—à ID: <code>{user_id}</code></b>

<b>üí≥ –î–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø" –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞!</b>""",
                parse_mode=ParseMode.HTML,
                reply_markup=get_main_keyboard(user_id)
            )

# =========== –§–£–ù–ö–¶–ò–ò –ü–†–û–í–ï–†–ö–ò –§–ê–ô–õ–û–í ===========
def create_audio_stubs():
    """–°–æ–∑–¥–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"""
    os.makedirs(AUDIO_CONFIG["base_path"], exist_ok=True)
    
    for module in MODULES:
        audio_file = module.get("audio_file")
        if audio_file:
            audio_path = os.path.join(AUDIO_CONFIG["base_path"], audio_file)
            if not os.path.exists(audio_path):
                try:
                    with open(audio_path, 'w', encoding='utf-8') as f:
                        f.write(f"Audio stub for module {module['id']}: {module['title']}\n")
                        f.write(f"Duration: {module.get('audio_duration', 120)} seconds\n")
                        f.write(f"File will be available after setup\n")
                    logger.info(f"Created audio stub: {audio_path}")
                except Exception as e:
                    logger.error(f"Failed to create audio stub: {e}")

async def check_audio_files():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"""
    logger.info("–ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã...")
    
    os.makedirs(AUDIO_CONFIG["base_path"], exist_ok=True)
    
    missing_files = []
    
    for i, module in enumerate(MODULES):
        audio_file = module.get("audio_file")
        if audio_file:
            audio_path = os.path.join(AUDIO_CONFIG["base_path"], audio_file)
            if os.path.exists(audio_path):
                file_size = os.path.getsize(audio_path) / (1024 * 1024)
                logger.info(f"‚úì –ê—É–¥–∏–æ –¥–ª—è —É—Ä–æ–∫–∞ {i+1}: {audio_file} ({file_size:.2f} –ú–ë)")
            else:
                logger.warning(f"‚úó –ê—É–¥–∏–æ –¥–ª—è —É—Ä–æ–∫–∞ {i+1} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: {audio_file}")
                missing_files.append((i+1, audio_file))
        else:
            logger.warning(f"‚úó –£—Ä–æ–∫ {i+1} –Ω–µ –∏–º–µ–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞")
    
    if missing_files:
        logger.error(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã: {missing_files}")
    else:
        logger.info("‚úì –í—Å–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ")
    
    return len(missing_files) == 0

async def check_checklist_file():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —á–µ–∫-–ª–∏—Å—Ç–∞"""
    checklist_path = "–ß–µ–∫-–ª–∏—Å—Ç -–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö-.docx"
    
    if os.path.exists(checklist_path):
        file_size = os.path.getsize(checklist_path) / 1024
        logger.info(f"‚úì –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞–π–¥–µ–Ω: {checklist_path} ({file_size:.1f} –ö–ë)")
        return True
    else:
        logger.warning(f"‚úó –ß–µ–∫-–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: {checklist_path}")
        logger.warning("–ö–Ω–æ–ø–∫–∞ 'üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç' –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞")
        return False

async def check_qr_code():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ QR-–∫–æ–¥–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã"""
    qr_code_path = "qr_code.png"
    
    if os.path.exists(qr_code_path):
        file_size = os.path.getsize(qr_code_path) / 1024
        logger.info(f"‚úì QR-–∫–æ–¥ –Ω–∞–π–¥–µ–Ω: {qr_code_path} ({file_size:.1f} –ö–ë)")
        return True
    else:
        logger.warning(f"‚úó QR-–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω: {qr_code_path}")
        logger.warning("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã")
        return False

async def check_required_files():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤"""
    logger.info("–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã...")
    
    required_files = [
        "admins.json",
        "paid_users.json",
        USER_PROGRESS_FILE,
        "–ß–µ–∫-–ª–∏—Å—Ç -–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö-.docx"
    ]
    
    missing_files = []
    for file in required_files:
        if not os.path.exists(file):
            missing_files.append(file)
            logger.warning(f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file}")
    
    if not os.path.exists(AUDIO_CONFIG["base_path"]):
        os.makedirs(AUDIO_CONFIG["base_path"], exist_ok=True)
        logger.info(f"–°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞: {AUDIO_CONFIG['base_path']}")
    
    audio_files = []
    for module in MODULES:
        audio_file = module.get("audio_file")
        if audio_file:
            audio_path = os.path.join(AUDIO_CONFIG["base_path"], audio_file)
            if not os.path.exists(audio_path):
                audio_files.append(audio_file)
    
    if missing_files:
        logger.error(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–π–ª—ã: {missing_files}")
    else:
        logger.info("‚úì –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ")
    
    if audio_files:
        logger.warning(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã: {len(audio_files)} –∏–∑ {sum(1 for m in MODULES if m.get('has_audio'))}")
    
    return len(missing_files) == 0 and len(audio_files) == 0

# =========== HTTP –°–ï–†–í–ï–† –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê ===========
async def health_check(request):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è health check"""
    return web.json_response({
        "status": "ok",
        "timestamp": datetime.now().isoformat(),
        "users": len(user_progress),
        "paid_users": len(access_control.get_all_paid_users()),
        "admins": len(access_control.get_all_admins()),
        "modules": len(MODULES),
        "restarts": restart_count,
        "checklist_available": os.path.exists("–ß–µ–∫-–ª–∏—Å—Ç -–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö-.docx"),
        "qr_code_available": os.path.exists("qr_code.png"),
        "price": {
            "discount": 3999,
            "after_discount": 4999,
            "discount_valid_until": "2026-01-31"
        }
    })

async def start_http_server():
    """–ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
    app = web.Application()
    app.router.add_get('/health', health_check)
    app.router.add_get('/', lambda request: web.Response(text="Telegram Bot is running!"))
    
    runner = web.AppRunner(app)
    await runner.setup()
    site = web.TCPSite(runner, '0.0.0.0', PORT)
    await site.start()
    
    logger.info(f"HTTP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {PORT}")
    return runner

# =========== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ü–£–°–ö–ê –ë–û–¢–ê ===========
async def run_bot_with_retries():
    """
    –ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –ø—Ä–∏ —Å–±–æ—è—Ö
    """
    global bot_instance, dp_instance, shutdown_flag, restart_count
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
    files_ok = await check_required_files()
    if not files_ok:
        logger.warning("–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.")
    
    # –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
    create_audio_stubs()
    
    bot_instance = bot
    dp_instance = dp
    
    while not shutdown_flag and restart_count < max_restarts:
        try:
            logger.info(f"üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–ø–æ–ø—ã—Ç–∫–∞ {restart_count + 1}/{max_restarts})...")
            logger.info(f"–ü–æ—Ä—Ç –¥–ª—è HTTP: {PORT}")
            
            logger.info(f"‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–∑ .env –∑–∞–≥—Ä—É–∂–µ–Ω—ã: {access_control.get_all_admins()}")
            logger.info(f"‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É: –í–ö–õ–Æ–ß–ï–ù–û")
            logger.info(f"‚úÖ Inline-–∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –º–æ–¥—É–ª—è: –î–û–ë–ê–í–õ–ï–ù–ê –í –ê–£–î–ò–û")
            logger.info(f"‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å –∫—É—Ä—Å–∞ –ø–æ –∞–∫—Ü–∏–∏: 3 999 —Ä—É–±. –≤–º–µ—Å—Ç–æ 5 000 —Ä—É–±.")
            logger.info(f"‚úÖ *–ê–∫—Ü–∏—è –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞")
            logger.info(f"‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω: {len(user_progress)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
            logger.info(f"‚úÖ –í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π –≤ –∫—É—Ä—Å–µ: {len(MODULES)}")
        
            await check_audio_files()
            await check_checklist_file()
            await check_qr_code()
            
            http_runner = await start_http_server()
            
            try:
                bot_info = await bot.get_me()
                logger.info(f"‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω: @{bot_info.username} (ID: {bot_info.id})")
                logger.info(f"‚úÖ –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞: {len(access_control.get_all_admins())} –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, {len(access_control.get_all_paid_users())} –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö")
                logger.info(f"‚úÖ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø")
                logger.info(f"‚úÖ –ê—É–¥–∏–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π: {sum(1 for m in MODULES if m.get('has_audio'))}/{len(MODULES)} —É—Ä–æ–∫–æ–≤")
                logger.info(f"‚úÖ QR-–∫–æ–¥ –æ–ø–ª–∞—Ç—ã: {'–î–æ—Å—Ç—É–ø–µ–Ω' if os.path.exists('qr_code.png') else '–ù–µ –Ω–∞–π–¥–µ–Ω'}")
                logger.info(f"‚úÖ HTTP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {PORT}")
                logger.info(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: –í–ö–õ–Æ–ß–ï–ù–û ({USER_PROGRESS_FILE})")
                logger.info(f"‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: –í–ö–õ–Æ–ß–ï–ù–û (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)")
            except Exception as e:
                logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Telegram API: {e}")
                logger.error("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à BOT_TOKEN –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É")
                restart_count += 1
                if not shutdown_flag:
                    logger.info(f"‚è≥ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ {restart_delay} —Å–µ–∫—É–Ω–¥...")
                    await asyncio.sleep(restart_delay)
                continue
            
            try:
                logger.info("üîÑ –ù–∞—á–∏–Ω–∞–µ–º polling...")
                # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                auto_save_task = asyncio.create_task(auto_save_progress())
                await dp.start_polling(bot, skip_updates=True)
            except asyncio.CancelledError:
                logger.info("‚úÖ Polling –æ—Ç–º–µ–Ω–µ–Ω (graceful shutdown)")
                break
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ polling: {e}")
                logger.error(f"–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–∫–∏: {traceback.format_exc()}")
                
                restart_count += 1
                if not shutdown_flag and restart_count < max_restarts:
                    logger.info(f"üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ {restart_delay} —Å–µ–∫—É–Ω–¥ (–ø–æ–ø—ã—Ç–∫–∞ {restart_count}/{max_restarts})...")
                    await asyncio.sleep(restart_delay)
                else:
                    logger.error(f"‚ùå –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ ({max_restarts}). –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
                    break
                    
        except Exception as e:
            logger.error(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ: {e}")
            logger.error(f"–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–∫–∏: {traceback.format_exc()}")
            
            restart_count += 1
            if not shutdown_flag and restart_count < max_restarts:
                logger.info(f"üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ {restart_delay * 2} —Å–µ–∫—É–Ω–¥ (–ø–æ–ø—ã—Ç–∫–∞ {restart_count}/{max_restarts})...")
                await asyncio.sleep(restart_delay * 2)
            else:
                logger.error(f"‚ùå –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ ({max_restarts}). –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
                break
    
    logger.info("üõë –ë–æ—Ç –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
    
    try:
        await bot.session.close()
        logger.info("‚úÖ –°–µ—Å—Å–∏—è –±–æ—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∞")
    except:
        pass

# =========== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–£–°–ö–ê ===========
async def main():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ graceful shutdown
    """
    global shutdown_flag
    
    bot_task = asyncio.create_task(run_bot_with_retries())
    
    try:
        await bot_task
    except KeyboardInterrupt:
        logger.info("‚úÖ –ü–æ–ª—É—á–µ–Ω KeyboardInterrupt, –∏–Ω–∏—Ü–∏–∏—Ä—É–µ–º shutdown...")
        shutdown_flag = True
        await shutdown()
    except Exception as e:
        logger.error(f"‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ main: {e}")
        logger.error(f"–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–∫–∏: {traceback.format_exc()}")
    finally:
        if not bot_task.done():
            bot_task.cancel()
            try:
                await bot_task
            except asyncio.CancelledError:
                pass

# =========== –¢–û–ß–ö–ê –í–•–û–î–ê ===========
if __name__ == "__main__":
    try:
        print("=" * 60)
        print("ü§ñ –ë–æ—Ç –æ–±—É—á–µ–Ω–∏—è —Ç–µ–Ω–¥–µ—Ä–∞–º —Å —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞")
        print("=" * 60)
        print(f"üìÖ –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        print(f"üîê –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞: –í–∫–ª—é—á–µ–Ω–∞")
        print(f"üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(access_control.get_all_admins())}")
        print(f"üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º: {len(access_control.get_all_paid_users())}")
        print(f"üìö –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω: {len(user_progress)}")
        print(f"üéØ –ö–Ω–æ–ø–∫–∞ –≤ –∞—É–¥–∏–æ: ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π")
        print(f"üìä –í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π –≤ –∫—É—Ä—Å–µ: {len(MODULES)}")
        print(f"üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∫—É—Ä—Å–∞ –ø–æ –∞–∫—Ü–∏–∏: 3 999 —Ä—É–±. –ê–∫—Ü–∏—è –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥.")
        print(f"üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Å–ª–µ –∞–∫—Ü–∏–∏: 5 000 —Ä—É–±.")
        print(f"üì± QR-–∫–æ–¥ –æ–ø–ª–∞—Ç—ã: {'‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç' if os.path.exists('qr_code.png') else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
        print(f"üîÑ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤: {max_restarts}")
        print(f"‚è± –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏: {restart_delay} —Å–µ–∫")
        print(f"üìö –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π: {len(MODULES)}")
        print(f"üéß –ê—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ —Å –∫–Ω–æ–ø–∫–æ–π: {sum(1 for m in MODULES if m.get('has_audio'))}")
        print(f"üìù –í–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ—Å—Ç–µ: {len(TEST_QUESTIONS)}")
        print(f"üì• –ß–µ–∫-–ª–∏—Å—Ç: {'‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç' if os.path.exists('–ß–µ–∫-–ª–∏—Å—Ç -–ü–µ—Ä–≤—ã–µ 10 —à–∞–≥–æ–≤ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö-.docx') else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
        print(f"üåê HTTP –ø–æ—Ä—Ç: {PORT}")
        print("=" * 60)
        print("üîê –í–ê–ñ–ù–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò –°–ò–°–¢–ï–ú–´:")
        print(f"‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω 8-–π –º–æ–¥—É–ª—å: üéÅ –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤")
        print("‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É –∫—É—Ä—Å—É")
        print("‚Ä¢ –ú–µ—Ç–æ–¥ is_paid_user –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤")
        print("‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∫—É—Ä—Å–∞ –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å")
        print("‚Ä¢ –ê—É–¥–∏–æ-—Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç inline-–∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –º–æ–¥—É–ª—è")
        print("‚Ä¢ QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã 3 999 —Ä—É–±. *–ê–∫—Ü–∏—è –¥–æ –∫–æ–Ω—Ü–∞ —è–Ω–≤–∞—Ä—è 2026 –≥.")
        print("‚Ä¢ –ü–æ—Å–ª–µ –∞–∫—Ü–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–≤—ã—Å–∏—Ç—Å—è –¥–æ 5 000 —Ä—É–±.")
        print("‚Ä¢ –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ")
        print("‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ –∑–∞–ø—Ä–æ—Å–µ –¥–æ—Å—Ç—É–ø–∞")
        print("‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ")
        print("‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞")
        print("‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω —Å–∞–π—Ç –¢—Ä–∏—Ç–∏–∫–∞ –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã")
        print("‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫–∞–∫ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É 'üîì –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø'")
        print("‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª user_progress.json")
        print("‚Ä¢ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç")
        print("‚Ä¢ –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∞—Ä–∫–∞—Ö –¥–ª—è –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤")
        print("=" * 60)
        
        asyncio.run(main())
        
    except KeyboardInterrupt:
        print("\n\n‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
        logger.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (KeyboardInterrupt)")
    except Exception as e:
        print(f"\n\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: {e}")
        logger.error(f"–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–∫–∏: {traceback.format_exc()}")
        sys.exit(1)



